import{lexer}from"css-tree";import{packNumber}from"./Number.js";const NAME_TO_HEX={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgrey:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},HEX_TO_NAME={8e5:"maroon",800080:"purple",808e3:"olive",808080:"gray","00ffff":"cyan",f0ffff:"azure",f5f5dc:"beige",ffe4c4:"bisque","000000":"black","0000ff":"blue",a52a2a:"brown",ff7f50:"coral",ffd700:"gold","008000":"green","4b0082":"indigo",fffff0:"ivory",f0e68c:"khaki","00ff00":"lime",faf0e6:"linen","000080":"navy",ffa500:"orange",da70d6:"orchid",cd853f:"peru",ffc0cb:"pink",dda0dd:"plum",f00:"red",ff0000:"red",fa8072:"salmon",a0522d:"sienna",c0c0c0:"silver",fffafa:"snow",d2b48c:"tan","008080":"teal",ff6347:"tomato",ee82ee:"violet",f5deb3:"wheat",ffffff:"white",ffff00:"yellow"};function hueToRgb(e,a,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?e+6*(a-e)*f:f<.5?a:f<2/3?e+(a-e)*(2/3-f)*6:e}function hslToRgb(e,a,f,r){let t,n,l;if(0===a)t=n=l=f;else{const r=f<.5?f*(1+a):f+a-f*a,o=2*f-r;t=hueToRgb(o,r,e+1/3),n=hueToRgb(o,r,e),l=hueToRgb(o,r,e-1/3)}return[Math.round(255*t),Math.round(255*n),Math.round(255*l),r]}function toHex(e){return 1===(e=e.toString(16)).length?"0"+e:e}function parseFunctionArgs(e,a,f){let r=e.head,t=[],n=!1;for(;null!==r;){const{type:e,value:a}=r.data;switch(e){case"Number":case"Percentage":if(n)return;n=!0,t.push({type:e,value:Number(a)});break;case"Operator":if(","===a){if(!n)return;n=!1}else if(n||"+"!==a)return;break;default:return}r=r.next}if(t.length===a){if(4===t.length){if("Number"!==t[3].type)return;t[3].type="Alpha"}if(f){if(t[0].type!==t[1].type||t[0].type!==t[2].type)return}else{if("Number"!==t[0].type||"Percentage"!==t[1].type||"Percentage"!==t[2].type)return;t[0].type="Angle"}return t.map(function(e){let a=Math.max(0,e.value);switch(e.type){case"Number":a=Math.min(a,255);break;case"Percentage":if(a=Math.min(a,100)/100,!f)return a;a*=255;break;case"Angle":return(a%360+360)%360/360;case"Alpha":return Math.min(a,1)}return Math.round(a)})}}export function compressFunction(e,a){let f,r=e.name;if("rgba"===r||"hsla"===r){if(f=parseFunctionArgs(e.children,4,"rgba"===r),!f)return;if("hsla"===r&&(f=hslToRgb(...f),e.name="rgba"),0===f[3]){const r=this.function&&this.function.name;if(0===f[0]&&0===f[1]&&0===f[2]||!/^(?:to|from|color-stop)$|gradient$/i.test(r))return void(a.data={type:"Identifier",loc:e.loc,name:"transparent"})}if(1!==f[3])return void e.children.forEach((e,a,r)=>{"Operator"!==e.type?a.data={type:"Number",loc:e.loc,value:packNumber(f.shift())}:","!==e.value&&r.remove(a)});r="rgb"}if("hsl"===r){if(f=f||parseFunctionArgs(e.children,3,!1),!f)return;f=hslToRgb(...f),r="rgb"}if("rgb"===r){if(f=f||parseFunctionArgs(e.children,3,!0),!f)return;a.data={type:"Hash",loc:e.loc,value:toHex(f[0])+toHex(f[1])+toHex(f[2])},compressHex(a.data,a)}}export function compressIdent(e,a){if(null===this.declaration)return;let f=e.name.toLowerCase();if(NAME_TO_HEX.hasOwnProperty(f)&&lexer.matchDeclaration(this.declaration).isType(e,"color")){const r=NAME_TO_HEX[f];r.length+1<=f.length?a.data={type:"Hash",loc:e.loc,value:r}:("grey"===f&&(f="gray"),e.name=f)}}export function compressHex(e,a){let f=e.value.toLowerCase();6===f.length&&f[0]===f[1]&&f[2]===f[3]&&f[4]===f[5]&&(f=f[0]+f[2]+f[4]),HEX_TO_NAME[f]?a.data={type:"Identifier",loc:e.loc,name:HEX_TO_NAME[f]}:e.value=f}