import{walk,generate,keyword as resolveKeyword}from"css-tree";import createDeclarationIndexer from"./createDeclarationIndexer.js";import processSelector from"./processSelector.js";export default function prepare(e,r){const o=createDeclarationIndexer();return walk(e,{visit:"Rule",enter(e){e.block.children.forEach(o),processSelector(e,r.usage)}}),walk(e,{visit:"Atrule",enter(e){e.prelude&&(e.prelude.id=null,e.prelude.id=generate(e.prelude)),"keyframes"===resolveKeyword(e.name).basename&&(e.block.avoidRulesMerge=!0,e.block.children.forEach(function(e){e.prelude.children.forEach(function(e){e.compareMarker=e.id})}))}}),{declaration:o}}