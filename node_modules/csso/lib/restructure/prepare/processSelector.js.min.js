import{generate}from"css-tree";import specificity from"./specificity.js";const nonFreezePseudoElements=new Set(["first-letter","first-line","after","before"]),nonFreezePseudoClasses=new Set(["link","visited","hover","active","first-letter","first-line","after","before"]);export default function processSelector(e,r){const s=new Set;e.prelude.children.forEach(function(e){let t="*",o=0;e.children.forEach(function(a){switch(a.type){case"ClassSelector":if(r&&r.scopes){const s=r.scopes[a.name]||0;if(0!==o&&s!==o)throw new Error("Selector can't has classes from different scopes: "+generate(e));o=s}break;case"PseudoClassSelector":{const e=a.name.toLowerCase();nonFreezePseudoClasses.has(e)||s.add(`:${e}`);break}case"PseudoElementSelector":{const e=a.name.toLowerCase();nonFreezePseudoElements.has(e)||s.add(`::${e}`);break}case"TypeSelector":t=a.name.toLowerCase();break;case"AttributeSelector":a.flags&&s.add(`[${a.flags.toLowerCase()}]`);break;case"Combinator":t="*"}}),e.compareMarker=specificity(e).toString(),e.id=null,e.id=generate(e),o&&(e.compareMarker+=":"+o),"*"!==t&&(e.compareMarker+=","+t)}),e.pseudoSignature=s.size>0&&[...s].sort().join(",")}