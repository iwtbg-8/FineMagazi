import{walk}from"css-tree";import{unsafeToSkipNode,isEqualDeclarations}from"./utils.js";function processRule(e,r,i){const t=e.prelude.children,n=e.block.children,o=t.first.compareMarker,a={};i.nextUntil(r.next,function(r,s){if("Rule"!==r.type)return unsafeToSkipNode.call(t,r);if(e.pseudoSignature!==r.pseudoSignature)return!0;const u=r.prelude.children.head,l=r.block.children,d=u.data.compareMarker;if(d in a)return!0;if(t.head===t.tail&&t.first.id===u.data.id)return n.appendList(l),void i.remove(s);if(isEqualDeclarations(n,l)){const e=u.data.id;return t.some((r,i)=>{const n=r.id;return e<n?(t.insert(u,i),!0):i.next?void 0:(t.insert(u),!0)}),void i.remove(s)}if(d===o)return!0;a[d]=!0})}export default function mergeRule(e){walk(e,{visit:"Rule",enter:processRule})}