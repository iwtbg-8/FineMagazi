"use strict";import{defaults,makePredicate,noop,regexp_source_fix,sort_regexp_flags,return_false,return_true}from"./utils/index.js";import{first_in_statement,left_is_object}from"./utils/first_in_statement.js";import{AST_Array,AST_Arrow,AST_Assign,AST_Await,AST_BigInt,AST_Binary,AST_BlockStatement,AST_Break,AST_Call,AST_Case,AST_Catch,AST_Chain,AST_Class,AST_ClassExpression,AST_ClassPrivateProperty,AST_ClassProperty,AST_ClassStaticBlock,AST_ConciseMethod,AST_PrivateGetter,AST_PrivateMethod,AST_SymbolPrivateProperty,AST_PrivateSetter,AST_PrivateIn,AST_Conditional,AST_Const,AST_Constant,AST_Continue,AST_Debugger,AST_Default,AST_DefaultAssign,AST_Definitions,AST_DefinitionsLike,AST_Defun,AST_Destructuring,AST_Directive,AST_Do,AST_Dot,AST_DotHash,AST_EmptyStatement,AST_Exit,AST_Expansion,AST_Export,AST_Finally,AST_For,AST_ForIn,AST_ForOf,AST_Function,AST_Hole,AST_If,AST_Import,AST_ImportMeta,AST_Jump,AST_LabeledStatement,AST_Lambda,AST_Let,AST_LoopControl,AST_NameMapping,AST_New,AST_NewTarget,AST_Node,AST_Number,AST_Object,AST_ObjectGetter,AST_ObjectKeyVal,AST_ObjectProperty,AST_ObjectSetter,AST_PrefixedTemplateString,AST_PropAccess,AST_RegExp,AST_Return,AST_Scope,AST_Sequence,AST_SimpleStatement,AST_Statement,AST_StatementWithBody,AST_String,AST_Sub,AST_Super,AST_Switch,AST_SwitchBranch,AST_Symbol,AST_SymbolClassProperty,AST_SymbolMethod,AST_SymbolRef,AST_TemplateSegment,AST_TemplateString,AST_This,AST_Throw,AST_Toplevel,AST_Try,AST_TryBlock,AST_Unary,AST_UnaryPostfix,AST_UnaryPrefix,AST_Using,AST_Var,AST_VarDefLike,AST_While,AST_With,AST_Yield,TreeWalker,walk,walk_abort}from"./ast.js";import{get_full_char_code,get_full_char,is_identifier_char,is_basic_identifier_string,is_identifier_string,PRECEDENCE,ALL_RESERVED_WORDS}from"./parse.js";const CODE_LINE_BREAK=10,CODE_SPACE=32,r_annotation=/[@#]__(PURE|INLINE|NOINLINE)__/;function is_some_comments(n){return("comment2"===n.type||"comment1"===n.type)&&/@preserve|@copyright|@lic|@cc_on|^\**!/i.test(n.value)}const ROPE_COMMIT_WHEN=8e3;class Rope{constructor(){this.committed="",this.current=""}append(n){this.current.length>8e3?(this.committed+=this.current+n,this.current=""):this.current+=n}insertAt(n,t){const{committed:e,current:i}=this;t<e.length?this.committed=e.slice(0,t)+n+e.slice(t):t===e.length?this.committed+=n:(t-=e.length,this.committed+=i.slice(0,t)+n,this.current=i.slice(t))}charAt(n){const{committed:t}=this;return n<t.length?t[n]:this.current[n-t.length]}charCodeAt(n){const{committed:t}=this;return n<t.length?t.charCodeAt(n):this.current.charCodeAt(n-t.length)}length(){return this.committed.length+this.current.length}expectDirective(){let n,t=this.length();if(t<=0)return!0;for(;(n=this.charCodeAt(--t))&&(32==n||10==n););return!n||59===n||123===n}hasNLB(){let n=this.length()-1;for(;n>=0;){const t=this.charCodeAt(n--);if(10===t)return!0;if(32!==t)return!1}return!0}toString(){return this.committed+this.current}}function OutputStream(n){var t=!n;void 0===(n=defaults(n,{ascii_only:!1,beautify:!1,braces:!1,comments:"some",ecma:5,ie8:!1,indent_level:4,indent_start:0,inline_script:!0,keep_numbers:!1,keep_quoted_props:!1,max_line_len:!1,preamble:null,preserve_annotations:!1,quote_keys:!1,quote_style:0,safari10:!1,semicolons:!0,shebang:!0,shorthand:void 0,source_map:null,webkit:!1,width:80,wrap_iife:!1,wrap_func_args:!1,_destroy_ast:!1},!0)).shorthand&&(n.shorthand=n.ecma>5);var e=return_false;if(n.comments){let t=n.comments;if("string"==typeof n.comments&&/^\/.*\/[a-zA-Z]*$/.test(n.comments)){var i=n.comments.lastIndexOf("/");t=new RegExp(n.comments.substr(1,i-1),n.comments.substr(i+1))}e=t instanceof RegExp?function(n){return"comment5"!=n.type&&t.test(n.value)}:"function"==typeof t?function(n){return"comment5"!=n.type&&t(this,n)}:"some"===t?is_some_comments:return_true}if(n.preserve_annotations){let n=e;e=function(t){return r_annotation.test(t.value)||n.apply(this,arguments)}}var r=0,o=0,a=1,s=0,c=new Rope;let p=new Set;var _=n.ascii_only?function(t,e=!1,i=!1){return n.ecma>=2015&&!n.safari10&&!i&&(t=t.replace(/[\ud800-\udbff][\udc00-\udfff]/g,function(n){return"\\u{"+get_full_char_code(n,0).toString(16)+"}"})),t.replace(/[\u0000-\u001f\u007f-\uffff]/g,function(n){var t=n.charCodeAt(0).toString(16);if(t.length<=2&&!e){for(;t.length<2;)t="0"+t;return"\\x"+t}for(;t.length<4;)t="0"+t;return"\\u"+t})}:function(n){return n.replace(/[\ud800-\udbff][\udc00-\udfff]|([\ud800-\udbff]|[\udc00-\udfff])/g,function(n,t){return t?"\\u"+t.charCodeAt(0).toString(16):n})};function f(t,e){var i=function(t,e){var i=0,r=0;function o(){return"'"+t.replace(/\x27/g,"\\'")+"'"}function a(){return'"'+t.replace(/\x22/g,'\\"')+'"'}if(t=t.replace(/[\\\b\f\n\r\v\t\x22\x27\u2028\u2029\0\ufeff]/g,function(e,o){switch(e){case'"':return++i,'"';case"'":return++r,"'";case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\v":return n.ie8?"\\x0B":"\\v";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";case"\ufeff":return"\\ufeff";case"\0":return/[0-9]/.test(get_full_char(t,o+1))?"\\x00":"\\0"}return e}),t=_(t),"`"===e)return"`"+t.replace(/`/g,"\\`")+"`";switch(n.quote_style){case 1:return o();case 2:return a();case 3:return"'"==e?o():a();default:return i>r?o():a()}}(t,e);return n.inline_script&&(i=(i=(i=i.replace(/<\x2f(script)([>\/\t\n\f\r ])/gi,"<\\/$1$2")).replace(/\x3c!--/g,"\\x3c!--")).replace(/--\x3e/g,"--\\x3e")),i}var u,S,l=!1,A=!1,T=!1,m=0,d=!1,h=!1,g=-1,v="",y=n.source_map&&[],b=y?function(){y.forEach(function(t){try{let{name:e,token:i}=t;!1!==e&&("name"==i.type||"privatename"===i.type?e=i.value:e instanceof AST_Symbol&&(e="string"===i.type?i.value:e.name)),n.source_map.add(t.token.file,t.line,t.col,t.token.line,t.token.col,is_basic_identifier_string(e)?e:void 0)}catch(n){}}),y=[]}:noop,x=n.max_line_len?function(){if(o>n.max_line_len&&m){c.insertAt("\n",m);const n=c.length()-m-1;if(y){var t=n-o;y.forEach(function(n){n.line++,n.col+=t})}a++,s++,o=n}m&&(m=0,b())}:noop,E=makePredicate("( [ + * / - , . `");function w(t){t=String(t);var e=get_full_char(t,0);d&&e&&(d=!1,"\n"!==e&&(w("\n"),D())),h&&e&&(h=!1,/[\s;})]/.test(e)||C()),g=-1;var i=v.charAt(v.length-1);T&&(T=!1,(":"!==i||"}"!==e)&&(e&&";}".includes(e)||";"===i)||(n.semicolons||E.has(e)?(c.append(";"),o++,s++):(x(),o>0&&(c.append("\n"),s++,a++,o=0),/^\s+$/.test(t)&&(T=!0)),n.beautify||(A=!1))),A&&((is_identifier_char(i)&&(is_identifier_char(e)||"\\"==e)||"/"==e&&e==i||("+"==e||"-"==e)&&e==v)&&(c.append(" "),o++,s++),A=!1),u&&(y.push({token:u,name:S,line:a,col:o}),u=!1,m||b()),c.append(t),l="("==t[t.length-1],s+=t.length;var r=t.split(/\r?\n/),p=r.length-1;a+=p,o+=r[0].length,p>0&&(x(),o=r[p].length),v=t}var C=n.beautify?function(){w(" ")}:function(){A=!0},D=n.beautify?function(t){var e;n.beautify&&w((e=t?.5:0," ".repeat(n.indent_start+r-e*n.indent_level)))}:noop,P=n.beautify?function(n,t){!0===n&&(n=B());var e=r;r=n;var i=t();return r=e,i}:function(n,t){return t()},k=n.beautify?function(){if(g<0)return w("\n");"\n"!=c.charAt(g)&&(c.insertAt("\n",g),s++,a++),g++}:n.max_line_len?function(){x(),m=c.length()}:noop,O=n.beautify?function(){w(";")}:function(){T=!0};function N(){T=!1,w(";")}function B(){return r+n.indent_level}var L=y?function(n,t){u=n,S=t}:noop;function q(){return m&&x(),c.toString()}function F(t){return n.preserve_annotations||(t=t.replace(r_annotation," ")),/^\s*$/.test(t)?"":t.replace(/(<\s*\/\s*)(script)/i,"<\\/$2")}const R=n._destroy_ast?function(n){n.body.length=0,n.argnames.length=0}:noop;var M=[];return{get:q,toString:q,indent:D,in_directive:!1,use_asm:null,active_scope:null,indentation:function(){return r},current_width:function(){return o-r},should_break:function(){return n.width&&this.current_width()>=n.width},has_parens:function(){return l},newline:k,print:w,star:function(){w("*")},space:C,comma:function(){w(","),C()},colon:function(){w(":"),C()},last:function(){return v},semicolon:O,force_semicolon:N,to_utf8:_,print_name:function(n){w(function(n){return n=n.toString(),_(n,!0)}(n))},print_string:function(n,t,e){var i=f(n,t);!0!==e||i.includes("\\")||(c.expectDirective()||N(),N()),w(i)},print_template_string_chars:function(n){var t=f(n,"`").replace(/\${/g,"\\${");return w(t.substr(1,t.length-2))},encode_string:f,next_indent:B,with_indent:P,with_block:function(n){var t;return w("{"),k(),P(B(),function(){t=n()}),D(),w("}"),t},with_parens:function(n){w("(");var t=n();return w(")"),t},with_square:function(n){w("[");var t=n();return w("]"),t},add_mapping:L,option:function(t){return n[t]},gc_scope:R,printed_comments:p,prepend_comments:t?noop:function(t){var i=t.start;if(!i)return;var r=this.printed_comments;const o=t instanceof AST_Exit&&t.value||(t instanceof AST_Await||t instanceof AST_Yield)&&t.expression;if(i.comments_before&&r.has(i.comments_before)){if(!o)return;i.comments_before=[]}var a=i.comments_before;if(a||(a=i.comments_before=[]),r.add(a),o){var p=new TreeWalker(function(n){var t=p.parent();if(!(t instanceof AST_Exit||t instanceof AST_Await||t instanceof AST_Yield||t instanceof AST_Binary&&t.left===n||"Call"==t.TYPE&&t.expression===n||t instanceof AST_Conditional&&t.condition===n||t instanceof AST_Dot&&t.expression===n||t instanceof AST_Sequence&&t.expressions[0]===n||t instanceof AST_Sub&&t.expression===n||t instanceof AST_UnaryPostfix))return!0;if(n.start){var e=n.start.comments_before;e&&!r.has(e)&&(r.add(e),a=a.concat(e))}});p.push(t),o.walk(p)}if(0==s){a.length>0&&n.shebang&&"comment5"===a[0].type&&!r.has(a[0])&&(w("#!"+a.shift().value+"\n"),D());var _=n.preamble;_&&w(_.replace(/\r\n?|[\n\u2028\u2029]|\s*$/g,"\n"))}if(0!=(a=a.filter(e,t).filter(n=>!r.has(n))).length){var f=c.hasNLB();a.forEach(function(n,t){if(r.add(n),f||(n.nlb?(w("\n"),D(),f=!0):t>0&&C()),/comment[134]/.test(n.type))(e=F(n.value))&&(w("//"+e+"\n"),D()),f=!0;else if("comment2"==n.type){var e;(e=F(n.value))&&w("/*"+e+"*/"),f=!1}}),f||(i.nlb?(w("\n"),D()):C())}},append_comments:t||e===return_false?noop:function(n,t){var i=n.end;if(i){var r=this.printed_comments,o=i[t?"comments_before":"comments_after"];if(o&&!r.has(o)&&(n instanceof AST_Statement||o.every(n=>!/comment[134]/.test(n.type)))){r.add(o);var a=c.length();o.filter(e,n).forEach(function(n,e){if(!r.has(n))if(r.add(n),h=!1,d?(w("\n"),D(),d=!1):n.nlb&&(e>0||!c.hasNLB())?(w("\n"),D()):(e>0||!t)&&C(),/comment[134]/.test(n.type)){const t=F(n.value);t&&w("//"+t),d=!0}else if("comment2"==n.type){const t=F(n.value);t&&w("/*"+t+"*/"),h=!0}}),c.length()>a&&(g=a)}}},line:function(){return a},col:function(){return o},pos:function(){return s},push_node:function(n){M.push(n)},pop_node:function(){return M.pop()},parent:function(n){return M[M.length-2-(n||0)]}}}!function(){function n(n,t){n.DEFMETHOD("_codegen",t)}function t(n,e){Array.isArray(n)?n.forEach(function(n){t(n,e)}):n.DEFMETHOD("needs_parens",e)}function e(n,t,e,i){var r=n.length-1;e.in_directive=i,n.forEach(function(n,i){!0!==e.in_directive||n instanceof AST_Directive||n instanceof AST_EmptyStatement||n instanceof AST_SimpleStatement&&n.body instanceof AST_String||(e.in_directive=!1),n instanceof AST_EmptyStatement||(e.indent(),n.print(e),i==r&&t||(e.newline(),t&&e.newline())),!0===e.in_directive&&n instanceof AST_SimpleStatement&&n.body instanceof AST_String&&(e.in_directive=!1)}),e.in_directive=!1}function i(n,t){t.print("{"),t.with_indent(t.next_indent(),function(){t.append_comments(n,!0)}),t.add_mapping(n.end),t.print("}")}function r(n,t,r){n.body.length>0?t.with_block(function(){e(n.body,!1,t,r),t.add_mapping(n.end)}):i(n,t)}function o(n,t,e){var i=!1;e&&(i=walk(n,n=>n instanceof AST_Scope&&!(n instanceof AST_Arrow)||(n instanceof AST_Binary&&"in"==n.operator||n instanceof AST_PrivateIn?walk_abort:void 0))),n.print(t,i)}function a(n,t,e){return e.option("quote_keys")?(e.print_string(n),!1):""+ +n==n&&n>=0?e.option("keep_numbers")?(e.print(n),!1):(e.print(f(n)),!1):(ALL_RESERVED_WORDS.has(n)?e.option("ie8"):e.option("ecma")<2015||e.option("safari10")?!is_basic_identifier_string(n):!is_identifier_string(n,!0))||t&&e.option("keep_quoted_props")?(e.print_string(n,t),!1):(e.print_name(n),!0)}AST_Node.DEFMETHOD("print",function(n,t){var e=this,i=e._codegen;function r(){n.prepend_comments(e),e.add_source_map(n),i(e,n),n.append_comments(e)}e instanceof AST_Scope?n.active_scope=e:!n.use_asm&&e instanceof AST_Directive&&"use asm"==e.value&&(n.use_asm=n.active_scope),n.push_node(e),t||e.needs_parens(n)?n.with_parens(r):r(),n.pop_node(),e===n.use_asm&&(n.use_asm=null)}),AST_Node.DEFMETHOD("_print",AST_Node.prototype.print),AST_Node.DEFMETHOD("print_to_string",function(n){var t=OutputStream(n);return this.print(t),t.get()}),t(AST_Node,return_false),t(AST_Function,function(n){if(!n.has_parens()&&first_in_statement(n))return!0;var t;if(n.option("webkit")&&((t=n.parent())instanceof AST_PropAccess&&t.expression===this))return!0;if(n.option("wrap_iife")&&((t=n.parent())instanceof AST_Call&&t.expression===this))return!0;if(n.option("wrap_func_args")&&((t=n.parent())instanceof AST_Call&&t.args.includes(this)))return!0;return!1}),t(AST_Arrow,function(n){var t=n.parent();return!!(n.option("wrap_func_args")&&t instanceof AST_Call&&t.args.includes(this))||(t instanceof AST_PropAccess&&t.expression===this||t instanceof AST_Conditional&&t.condition===this)}),t(AST_Object,function(n){return!n.has_parens()&&first_in_statement(n)}),t(AST_ClassExpression,first_in_statement),t(AST_Unary,function(n){var t=n.parent();return t instanceof AST_PropAccess&&t.expression===this||t instanceof AST_Call&&t.expression===this||t instanceof AST_Binary&&"**"===t.operator&&this instanceof AST_UnaryPrefix&&t.left===this&&"++"!==this.operator&&"--"!==this.operator}),t(AST_Await,function(n){var t=n.parent();return t instanceof AST_PropAccess&&t.expression===this||t instanceof AST_Call&&t.expression===this||t instanceof AST_Binary&&"**"===t.operator&&t.left===this||n.option("safari10")&&t instanceof AST_UnaryPrefix}),t(AST_Sequence,function(n){var t=n.parent();return t instanceof AST_Call||t instanceof AST_Unary||t instanceof AST_Binary||t instanceof AST_VarDefLike||t instanceof AST_PropAccess||t instanceof AST_Array||t instanceof AST_ObjectProperty||t instanceof AST_Conditional||t instanceof AST_Arrow||t instanceof AST_DefaultAssign||t instanceof AST_Expansion||t instanceof AST_ForOf&&this===t.object||t instanceof AST_Yield||t instanceof AST_Export}),t(AST_Binary,function(n){var t=n.parent();if(t instanceof AST_Call&&t.expression===this)return!0;if(t instanceof AST_Unary)return!0;if(t instanceof AST_PropAccess&&t.expression===this)return!0;if(t instanceof AST_Binary){const n=t.operator,e=this.operator;if("??"===e&&("||"===n||"&&"===n))return!0;if("??"===n&&("||"===e||"&&"===e))return!0;const i=PRECEDENCE[n],r=PRECEDENCE[e];if(i>r||i==r&&(this===t.right||"**"==n))return!0}if(t instanceof AST_PrivateIn){const n=this.operator,e=PRECEDENCE.in,i=PRECEDENCE[n];if(e>i||e==i&&this===t.value)return!0}}),t(AST_PrivateIn,function(n){var t=n.parent();if(t instanceof AST_Call&&t.expression===this)return!0;if(t instanceof AST_Unary)return!0;if(t instanceof AST_PropAccess&&t.expression===this)return!0;if(t instanceof AST_Binary){const n=t.operator,e=PRECEDENCE[n],i=PRECEDENCE.in;if(e>i||e==i&&(this===t.right||"**"==n))return!0}return t instanceof AST_PrivateIn&&this===t.value||void 0}),t(AST_Yield,function(n){var t=n.parent();return t instanceof AST_Binary&&"="!==t.operator||(t instanceof AST_Call&&t.expression===this||(t instanceof AST_Conditional&&t.condition===this||(t instanceof AST_Unary||(t instanceof AST_PropAccess&&t.expression===this||void 0))))}),t(AST_Chain,function(n){var t=n.parent();return(t instanceof AST_Call||t instanceof AST_PropAccess)&&t.expression===this}),t(AST_PropAccess,function(n){var t=n.parent();if(t instanceof AST_New&&t.expression===this)return walk(this,n=>n instanceof AST_Scope||(n instanceof AST_Call?walk_abort:void 0))}),t(AST_Call,function(n){var t,e=n.parent();return!!(e instanceof AST_New&&e.expression===this||e instanceof AST_Export&&e.is_default&&this.expression instanceof AST_Function)||this.expression instanceof AST_Function&&e instanceof AST_PropAccess&&e.expression===this&&(t=n.parent(1))instanceof AST_Assign&&t.left===e}),t(AST_New,function(n){var t=n.parent();if(0===this.args.length&&(t instanceof AST_PropAccess||t instanceof AST_Call&&t.expression===this||t instanceof AST_PrefixedTemplateString&&t.prefix===this))return!0}),t(AST_Number,function(n){var t=n.parent();if(t instanceof AST_PropAccess&&t.expression===this){var e=this.getValue();if(e<0||/^0/.test(f(e)))return!0}}),t(AST_BigInt,function(n){var t=n.parent();if(t instanceof AST_PropAccess&&t.expression===this&&this.getValue().startsWith("-"))return!0}),t([AST_Assign,AST_Conditional],function(n){var t=n.parent();return t instanceof AST_Unary||(t instanceof AST_Binary&&!(t instanceof AST_Assign)||(t instanceof AST_Call&&t.expression===this||(t instanceof AST_Conditional&&t.condition===this||(t instanceof AST_PropAccess&&t.expression===this||(this instanceof AST_Assign&&this.left instanceof AST_Destructuring&&!1===this.left.is_array||void 0)))))}),n(AST_Directive,function(n,t){t.print_string(n.value,n.quote),t.semicolon()}),n(AST_Expansion,function(n,t){t.print("..."),n.expression.print(t)}),n(AST_Destructuring,function(n,t){t.print(n.is_array?"[":"{");var e=n.names.length;n.names.forEach(function(n,i){i>0&&t.comma(),n.print(t),i==e-1&&n instanceof AST_Hole&&t.comma()}),t.print(n.is_array?"]":"}")}),n(AST_Debugger,function(n,t){t.print("debugger"),t.semicolon()}),AST_StatementWithBody.DEFMETHOD("_do_print_body",function(n){_(this.body,n)}),n(AST_Statement,function(n,t){n.body.print(t),t.semicolon()}),n(AST_Toplevel,function(n,t){e(n.body,!0,t,!0),t.print("")}),n(AST_LabeledStatement,function(n,t){n.label.print(t),t.colon(),n.body.print(t)}),n(AST_SimpleStatement,function(n,t){n.body.print(t),t.semicolon()}),n(AST_BlockStatement,function(n,t){r(n,t)}),n(AST_EmptyStatement,function(n,t){t.semicolon()}),n(AST_Do,function(n,t){t.print("do"),t.space(),u(n.body,t),t.space(),t.print("while"),t.space(),t.with_parens(function(){n.condition.print(t)}),t.semicolon()}),n(AST_While,function(n,t){t.print("while"),t.space(),t.with_parens(function(){n.condition.print(t)}),t.space(),n._do_print_body(t)}),n(AST_For,function(n,t){t.print("for"),t.space(),t.with_parens(function(){n.init?(n.init instanceof AST_DefinitionsLike?n.init.print(t):o(n.init,t,!0),t.print(";"),t.space()):t.print(";"),n.condition?(n.condition.print(t),t.print(";"),t.space()):t.print(";"),n.step&&n.step.print(t)}),t.space(),n._do_print_body(t)}),n(AST_ForIn,function(n,t){t.print("for"),n.await&&(t.space(),t.print("await")),t.space(),t.with_parens(function(){n.init.print(t),t.space(),t.print(n instanceof AST_ForOf?"of":"in"),t.space(),n.object.print(t)}),t.space(),n._do_print_body(t)}),n(AST_With,function(n,t){t.print("with"),t.space(),t.with_parens(function(){n.expression.print(t)}),t.space(),n._do_print_body(t)}),AST_Lambda.DEFMETHOD("_do_print",function(n,t){var e=this;t||(e.async&&(n.print("async"),n.space()),n.print("function"),e.is_generator&&n.star(),e.name&&n.space()),e.name instanceof AST_Symbol?e.name.print(n):t&&e.name instanceof AST_Node&&n.with_square(function(){e.name.print(n)}),n.with_parens(function(){e.argnames.forEach(function(t,e){e&&n.comma(),t.print(n)})}),n.space(),r(e,n,!0)}),n(AST_Lambda,function(n,t){n._do_print(t),t.gc_scope(n)}),n(AST_PrefixedTemplateString,function(n,t){var e=n.prefix,i=e instanceof AST_Lambda||e instanceof AST_Binary||e instanceof AST_Conditional||e instanceof AST_Sequence||e instanceof AST_Unary||e instanceof AST_Dot&&e.expression instanceof AST_Object;i&&t.print("("),n.prefix.print(t),i&&t.print(")"),n.template_string.print(t)}),n(AST_TemplateString,function(n,t){var e=t.parent()instanceof AST_PrefixedTemplateString;t.print("`");for(var i=0;i<n.segments.length;i++)n.segments[i]instanceof AST_TemplateSegment?e?t.print(n.segments[i].raw):t.print_template_string_chars(n.segments[i].value):(t.print("${"),n.segments[i].print(t),t.print("}"));t.print("`")}),n(AST_TemplateSegment,function(n,t){t.print_template_string_chars(n.value)}),AST_Arrow.DEFMETHOD("_do_print",function(n){var t=this,e=n.parent(),i=e instanceof AST_Binary&&!(e instanceof AST_Assign)&&!(e instanceof AST_DefaultAssign)||e instanceof AST_Unary||e instanceof AST_Call&&t===e.expression;i&&n.print("("),t.async&&(n.print("async"),n.space()),1===t.argnames.length&&t.argnames[0]instanceof AST_Symbol?t.argnames[0].print(n):n.with_parens(function(){t.argnames.forEach(function(t,e){e&&n.comma(),t.print(n)})}),n.space(),n.print("=>"),n.space();const o=t.body[0];if(1===t.body.length&&o instanceof AST_Return){const t=o.value;t?left_is_object(t)?(n.print("("),t.print(n),n.print(")")):t.print(n):n.print("{}")}else r(t,n);i&&n.print(")"),n.gc_scope(t)}),AST_Exit.DEFMETHOD("_do_print",function(n,t){if(n.print(t),this.value){n.space();const t=this.value.start.comments_before;t&&t.length&&!n.printed_comments.has(t)?(n.print("("),this.value.print(n),n.print(")")):this.value.print(n)}n.semicolon()}),n(AST_Return,function(n,t){n._do_print(t,"return")}),n(AST_Throw,function(n,t){n._do_print(t,"throw")}),n(AST_Yield,function(n,t){var e=n.is_star?"*":"";t.print("yield"+e),n.expression&&(t.space(),n.expression.print(t))}),n(AST_Await,function(n,t){t.print("await"),t.space();var e=n.expression,i=!(e instanceof AST_Call||e instanceof AST_SymbolRef||e instanceof AST_PropAccess||e instanceof AST_Unary||e instanceof AST_Constant||e instanceof AST_Await||e instanceof AST_Object);i&&t.print("("),n.expression.print(t),i&&t.print(")")}),AST_LoopControl.DEFMETHOD("_do_print",function(n,t){n.print(t),this.label&&(n.space(),this.label.print(n)),n.semicolon()}),n(AST_Break,function(n,t){n._do_print(t,"break")}),n(AST_Continue,function(n,t){n._do_print(t,"continue")}),n(AST_If,function(n,t){t.print("if"),t.space(),t.with_parens(function(){n.condition.print(t)}),t.space(),n.alternative?(!function(n,t){var e=n.body;if(t.option("braces")||t.option("ie8")&&e instanceof AST_Do)return u(e,t);if(!e)return t.force_semicolon();for(;;)if(e instanceof AST_If){if(!e.alternative)return void u(n.body,t);e=e.alternative}else{if(!(e instanceof AST_StatementWithBody))break;e=e.body}_(n.body,t)}(n,t),t.space(),t.print("else"),t.space(),n.alternative instanceof AST_If?n.alternative.print(t):_(n.alternative,t)):n._do_print_body(t)}),n(AST_Switch,function(n,t){t.print("switch"),t.space(),t.with_parens(function(){n.expression.print(t)}),t.space();var e=n.body.length-1;e<0?i(n,t):t.with_block(function(){n.body.forEach(function(n,i){t.indent(!0),n.print(t),i<e&&n.body.length>0&&t.newline()})})}),AST_SwitchBranch.DEFMETHOD("_do_print_body",function(n){n.newline(),this.body.forEach(function(t){n.indent(),t.print(n),n.newline()})}),n(AST_Default,function(n,t){t.print("default:"),n._do_print_body(t)}),n(AST_Case,function(n,t){t.print("case"),t.space(),n.expression.print(t),t.print(":"),n._do_print_body(t)}),n(AST_Try,function(n,t){t.print("try"),t.space(),n.body.print(t),n.bcatch&&(t.space(),n.bcatch.print(t)),n.bfinally&&(t.space(),n.bfinally.print(t))}),n(AST_TryBlock,function(n,t){r(n,t)}),n(AST_Catch,function(n,t){t.print("catch"),n.argname&&(t.space(),t.with_parens(function(){n.argname.print(t)})),t.space(),r(n,t)}),n(AST_Finally,function(n,t){t.print("finally"),t.space(),r(n,t)}),AST_DefinitionsLike.DEFMETHOD("_do_print",function(n,t){n.print(t),n.space(),this.definitions.forEach(function(t,e){e&&n.comma(),t.print(n)});var e=n.parent();(!(e instanceof AST_For||e instanceof AST_ForIn)||e&&e.init!==this)&&n.semicolon()}),n(AST_Let,function(n,t){n._do_print(t,"let")}),n(AST_Var,function(n,t){n._do_print(t,"var")}),n(AST_Const,function(n,t){n._do_print(t,"const")}),n(AST_Using,function(n,t){n._do_print(t,n.await?"await using":"using")}),n(AST_Import,function(n,t){t.print("import"),t.space(),n.imported_name&&n.imported_name.print(t),n.imported_name&&n.imported_names&&(t.print(","),t.space()),n.imported_names&&(1!==n.imported_names.length||"*"!==n.imported_names[0].foreign_name.name||n.imported_names[0].foreign_name.quote?(t.print("{"),n.imported_names.forEach(function(e,i){t.space(),e.print(t),i<n.imported_names.length-1&&t.print(",")}),t.space(),t.print("}")):n.imported_names[0].print(t)),(n.imported_name||n.imported_names)&&(t.space(),t.print("from"),t.space()),n.module_name.print(t),n.attributes&&(t.print("with"),n.attributes.print(t)),t.semicolon()}),n(AST_ImportMeta,function(n,t){t.print("import.meta")}),n(AST_NameMapping,function(n,t){var e=t.parent()instanceof AST_Import,i=n.name.definition(),r=n.foreign_name,o=(i&&i.mangled_name||n.name.name)!==r.name;o||"*"!==r.name||!!r.quote==!!n.name.quote||(o=!0);var a=!r.quote;o?(e?a?t.print(r.name):t.print_string(r.name,r.quote):n.name.quote?t.print_string(n.name.name,n.name.quote):n.name.print(t),t.space(),t.print("as"),t.space(),e?n.name.print(t):a?t.print(r.name):t.print_string(r.name,r.quote)):n.name.quote?t.print_string(n.name.name,n.name.quote):n.name.print(t)}),n(AST_Export,function(n,t){if(t.print("export"),t.space(),n.is_default&&(t.print("default"),t.space()),n.exported_names)1!==n.exported_names.length||"*"!==n.exported_names[0].name.name||n.exported_names[0].name.quote?(t.print("{"),n.exported_names.forEach(function(e,i){t.space(),e.print(t),i<n.exported_names.length-1&&t.print(",")}),t.space(),t.print("}")):n.exported_names[0].print(t);else if(n.exported_value)n.exported_value.print(t);else if(n.exported_definition&&(n.exported_definition.print(t),n.exported_definition instanceof AST_Definitions))return;n.module_name&&(t.space(),t.print("from"),t.space(),n.module_name.print(t)),n.attributes&&(t.print("with"),n.attributes.print(t)),(n.exported_value&&!(n.exported_value instanceof AST_Defun||n.exported_value instanceof AST_Function||n.exported_value instanceof AST_Class)||n.module_name||n.exported_names)&&t.semicolon()}),n(AST_VarDefLike,function(n,t){if(n.name.print(t),n.value){t.space(),t.print("="),t.space();var e=t.parent(1),i=e instanceof AST_For||e instanceof AST_ForIn;o(n.value,t,i)}}),n(AST_Call,function(n,t){n.expression.print(t),n instanceof AST_New&&0===n.args.length||((n.expression instanceof AST_Call||n.expression instanceof AST_Lambda)&&t.add_mapping(n.start),n.optional&&t.print("?."),t.with_parens(function(){n.args.forEach(function(n,e){e&&t.comma(),n.print(t)})}))}),n(AST_New,function(n,t){t.print("new"),t.space(),AST_Call.prototype._codegen(n,t)}),AST_Sequence.DEFMETHOD("_do_print",function(n){this.expressions.forEach(function(t,e){e>0&&(n.comma(),n.should_break()&&(n.newline(),n.indent())),t.print(n)})}),n(AST_Sequence,function(n,t){n._do_print(t)}),n(AST_Dot,function(n,t){var e=n.expression;e.print(t);var i=n.property,r=ALL_RESERVED_WORDS.has(i)?t.option("ie8"):!is_identifier_string(i,t.option("ecma")>=2015&&!t.option("safari10"));n.optional&&t.print("?."),r?(t.print("["),t.add_mapping(n.end),t.print_string(i),t.print("]")):(e instanceof AST_Number&&e.getValue()>=0&&(/[xa-f.)]/i.test(t.last())||t.print(".")),n.optional||t.print("."),t.add_mapping(n.end),t.print_name(i))}),n(AST_DotHash,function(n,t){n.expression.print(t);var e=n.property;n.optional&&t.print("?"),t.print(".#"),t.add_mapping(n.end),t.print_name(e)}),n(AST_Sub,function(n,t){n.expression.print(t),n.optional&&t.print("?."),t.print("["),n.property.print(t),t.print("]")}),n(AST_Chain,function(n,t){n.expression.print(t)}),n(AST_UnaryPrefix,function(n,t){var e=n.operator;"--"===e&&t.last().endsWith("!")&&t.print(" "),t.print(e),(/^[a-z]/i.test(e)||/[+-]$/.test(e)&&n.expression instanceof AST_UnaryPrefix&&/^[+-]/.test(n.expression.operator))&&t.space(),n.expression.print(t)}),n(AST_UnaryPostfix,function(n,t){n.expression.print(t),t.print(n.operator)}),n(AST_Binary,function(n,t){var e=n.operator;n.left.print(t),">"==e[0]&&t.last().endsWith("--")?t.print(" "):t.space(),t.print(e),t.space(),n.right.print(t)}),n(AST_Conditional,function(n,t){n.condition.print(t),t.space(),t.print("?"),t.space(),n.consequent.print(t),t.space(),t.colon(),n.alternative.print(t)}),n(AST_Array,function(n,t){t.with_square(function(){var e=n.elements,i=e.length;i>0&&t.space(),e.forEach(function(n,e){e&&t.comma(),n.print(t),e===i-1&&n instanceof AST_Hole&&t.comma()}),i>0&&t.space()})}),n(AST_Object,function(n,t){n.properties.length>0?t.with_block(function(){n.properties.forEach(function(n,e){e&&(t.print(","),t.newline()),t.indent(),n.print(t)}),t.newline()}):i(n,t)}),n(AST_Class,function(n,t){if(t.print("class"),t.space(),n.name&&(n.name.print(t),t.space()),n.extends){var e=!(n.extends instanceof AST_SymbolRef||n.extends instanceof AST_PropAccess||n.extends instanceof AST_ClassExpression||n.extends instanceof AST_Function);t.print("extends"),e?t.print("("):t.space(),n.extends.print(t),e?t.print(")"):t.space()}n.properties.length>0?t.with_block(function(){n.properties.forEach(function(n,e){e&&t.newline(),t.indent(),n.print(t)}),t.newline()}):t.print("{}")}),n(AST_NewTarget,function(n,t){t.print("new.target")}),n(AST_ObjectKeyVal,function(n,t){function e(n){var t=n.definition();return t?t.mangled_name||t.name:n.name}const i=t.option("shorthand")&&!(n.key instanceof AST_Node);if(i&&n.value instanceof AST_Symbol&&e(n.value)===n.key&&!ALL_RESERVED_WORDS.has(n.key)){a(n.key,n.quote,t)||(t.colon(),n.value.print(t))}else if(i&&n.value instanceof AST_DefaultAssign&&n.value.left instanceof AST_Symbol&&e(n.value.left)===n.key){a(n.key,n.quote,t)||(t.colon(),n.value.left.print(t)),t.space(),t.print("="),t.space(),n.value.right.print(t)}else n.key instanceof AST_Node?t.with_square(function(){n.key.print(t)}):a(n.key,n.quote,t),t.colon(),n.value.print(t)}),n(AST_ClassPrivateProperty,(n,t)=>{n.static&&(t.print("static"),t.space()),t.print("#"),a(n.key.name,void 0,t),n.value&&(t.print("="),n.value.print(t)),t.semicolon()}),n(AST_ClassProperty,(n,t)=>{n.static&&(t.print("static"),t.space()),n.key instanceof AST_SymbolClassProperty?a(n.key.name,n.quote,t):(t.print("["),n.key.print(t),t.print("]")),n.value&&(t.print("="),n.value.print(t)),t.semicolon()}),AST_ObjectProperty.DEFMETHOD("_print_getter_setter",function(n,t,e){var i=this;i.static&&(e.print("static"),e.space()),n&&(e.print(n),e.space()),i.key instanceof AST_SymbolMethod?(t&&e.print("#"),a(i.key.name,i.quote,e),i.key.add_source_map(e)):e.with_square(function(){i.key.print(e)}),i.value._do_print(e,!0)}),n(AST_ObjectSetter,function(n,t){n._print_getter_setter("set",!1,t)}),n(AST_ObjectGetter,function(n,t){n._print_getter_setter("get",!1,t)}),n(AST_PrivateSetter,function(n,t){n._print_getter_setter("set",!0,t)}),n(AST_PrivateGetter,function(n,t){n._print_getter_setter("get",!0,t)}),n(AST_ConciseMethod,function(n,t){var e;n.value.is_generator&&n.value.async?e="async*":n.value.is_generator?e="*":n.value.async&&(e="async"),n._print_getter_setter(e,!1,t)}),n(AST_PrivateMethod,function(n,t){var e;n.value.is_generator&&n.value.async?e="async*":n.value.is_generator?e="*":n.value.async&&(e="async"),n._print_getter_setter(e,!0,t)}),n(AST_PrivateIn,function(n,t){n.key.print(t),t.space(),t.print("in"),t.space(),n.value.print(t)}),n(AST_SymbolPrivateProperty,function(n,t){t.print("#"+n.name)}),n(AST_ClassStaticBlock,function(n,t){t.print("static"),t.space(),r(n,t)}),AST_Symbol.DEFMETHOD("_do_print",function(n){var t=this.definition();n.print_name(t?t.mangled_name||t.name:this.name)}),n(AST_Symbol,function(n,t){n._do_print(t)}),n(AST_Hole,noop),n(AST_This,function(n,t){t.print("this")}),n(AST_Super,function(n,t){t.print("super")}),n(AST_Constant,function(n,t){t.print(n.getValue())}),n(AST_String,function(n,t){t.print_string(n.getValue(),n.quote,t.in_directive)}),n(AST_Number,function(n,t){(t.option("keep_numbers")||t.use_asm)&&n.raw?t.print(n.raw):t.print(f(n.getValue()))}),n(AST_BigInt,function(n,t){t.option("keep_numbers")&&n.raw?t.print(n.raw):t.print(n.getValue()+"n")});const s=/(<\s*\/\s*script)/i,c=/^\s*script/i,p=(n,t)=>t.replace("/","\\/");function _(n,t){t.option("braces")?u(n,t):!n||n instanceof AST_EmptyStatement?t.force_semicolon():n instanceof AST_DefinitionsLike&&!(n instanceof AST_Var)||n instanceof AST_Class?u(n,t):n.print(t)}function f(n){var t,e,i,r=n.toString(10).replace(/^0\./,".").replace("e+","e"),o=[r];return Math.floor(n)===n&&(n<0?o.push("-0x"+(-n).toString(16).toLowerCase()):o.push("0x"+n.toString(16).toLowerCase())),(t=/^\.0+/.exec(r))?(e=t[0].length,i=r.slice(e),o.push(i+"e-"+(i.length+e-1))):(t=/0+$/.exec(r))?(e=t[0].length,o.push(r.slice(0,-e)+"e"+e)):(t=/^(\d)\.(\d+)e(-?\d+)$/.exec(r))&&o.push(t[1]+t[2]+"e"+(t[3]-t[2].length)),function(n){for(var t=n[0],e=t.length,i=1;i<n.length;++i)n[i].length<e&&(e=(t=n[i]).length);return t}(o)}function u(n,t){!n||n instanceof AST_EmptyStatement?t.print("{}"):n instanceof AST_BlockStatement?n.print(t):t.with_block(function(){t.indent(),n.print(t),t.newline()})}function S(n,t){n.forEach(function(n){n.DEFMETHOD("add_source_map",t)})}n(AST_RegExp,function(n,t){let{source:e,flags:i}=n.getValue();e=regexp_source_fix(e),i=i?sort_regexp_flags(i):"",e=e.replace(s,p),c.test(e)&&t.last().endsWith("<")&&t.print(" "),t.print(t.to_utf8(`/${e}/${i}`,!1,!0));const r=t.parent();r instanceof AST_Binary&&/^\w/.test(r.operator)&&r.left===n&&t.print(" ")}),S([AST_Node,AST_LabeledStatement,AST_Toplevel],noop),S([AST_Array,AST_BlockStatement,AST_Catch,AST_Class,AST_Constant,AST_Debugger,AST_DefinitionsLike,AST_Directive,AST_Finally,AST_Jump,AST_Lambda,AST_New,AST_Object,AST_StatementWithBody,AST_Symbol,AST_Switch,AST_SwitchBranch,AST_TemplateString,AST_TemplateSegment,AST_Try],function(n){n.add_mapping(this.start)}),S([AST_ObjectGetter,AST_ObjectSetter,AST_PrivateGetter,AST_PrivateSetter,AST_ConciseMethod,AST_PrivateMethod],function(n){n.add_mapping(this.start,!1)}),S([AST_SymbolMethod,AST_SymbolPrivateProperty],function(n){const t=this.end&&this.end.type;"name"===t||"privatename"===t?n.add_mapping(this.end,this.name):n.add_mapping(this.end)}),S([AST_ObjectProperty],function(n){n.add_mapping(this.start,this.key)})}();export{OutputStream};