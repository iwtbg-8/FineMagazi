"use strict";import{SourceMapConsumer,SourceMapGenerator}from"@jridgewell/source-map";import{defaults,HOP}from"./utils/index.js";function*SourceMap(e){var o;e=defaults(e,{file:null,root:null,orig:null,files:{}});var n=new SourceMapGenerator({file:e.file,sourceRoot:e.root});let r={__proto__:null},t=e.files;for(var u in t)HOP(t,u)&&(r[u]=t[u]);function l(e){return e.sourcesContent&&e.sourcesContent.every(e=>null==e)&&delete e.sourcesContent,void 0===e.file&&delete e.file,void 0===e.sourceRoot&&delete e.sourceRoot,e}return e.orig&&(o=yield new SourceMapConsumer(e.orig)).sourcesContent&&o.sources.forEach(function(e,n){var t=o.sourcesContent[n];t&&(r[e]=t)}),{add:function(e,t,u,l,i,c){let s={line:t,column:u};if(o){var a=o.originalPositionFor({line:l,column:i});if(null===a.source)return void n.addMapping({generated:s,original:null,source:null,name:null});e=a.source,l=a.line,i=a.column,c=a.name||c}n.addMapping({generated:s,original:{line:l,column:i},source:e,name:c}),n.setSourceContent(e,r[e])},getDecoded:function(){return n.toDecodedMap?l(n.toDecodedMap()):null},getEncoded:function(){return l(n.toJSON())},destroy:function(){o&&o.destroy&&o.destroy()}}}export{SourceMap};