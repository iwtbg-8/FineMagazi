import{AST_Accessor,AST_Array,AST_Arrow,AST_Assign,AST_BigInt,AST_Binary,AST_Block,AST_BlockStatement,AST_Boolean,AST_Break,AST_Call,AST_Catch,AST_Chain,AST_Class,AST_ClassProperty,AST_ClassStaticBlock,AST_ConciseMethod,AST_Conditional,AST_Const,AST_Constant,AST_Debugger,AST_Default,AST_DefaultAssign,AST_Definitions,AST_Defun,AST_Destructuring,AST_Directive,AST_Do,AST_Dot,AST_DotHash,AST_DWLoop,AST_EmptyStatement,AST_Exit,AST_Expansion,AST_Export,AST_False,AST_For,AST_ForIn,AST_Function,AST_Hole,AST_If,AST_Import,AST_Infinity,AST_LabeledStatement,AST_Lambda,AST_Let,AST_NaN,AST_New,AST_Node,AST_Null,AST_Number,AST_Object,AST_ObjectKeyVal,AST_ObjectProperty,AST_PrefixedTemplateString,AST_PropAccess,AST_RegExp,AST_Return,AST_Scope,AST_Sequence,AST_SimpleStatement,AST_Statement,AST_String,AST_Sub,AST_Switch,AST_SwitchBranch,AST_Symbol,AST_SymbolClassProperty,AST_SymbolDeclaration,AST_SymbolDefun,AST_SymbolExport,AST_SymbolFunarg,AST_SymbolLambda,AST_SymbolLet,AST_SymbolMethod,AST_SymbolRef,AST_SymbolUsing,AST_TemplateString,AST_This,AST_Toplevel,AST_True,AST_Try,AST_Unary,AST_UnaryPostfix,AST_UnaryPrefix,AST_Undefined,AST_Using,AST_Var,AST_VarDef,AST_While,AST_With,AST_Yield,TreeTransformer,TreeWalker,walk,walk_abort,_NOINLINE}from"../ast.js";import{defaults,HOP,make_node,makePredicate,MAP,remove,return_false,return_true,regexp_source_fix,has_annotation,regexp_is_safe}from"../utils/index.js";import{first_in_statement}from"../utils/first_in_statement.js";import{equivalent_to}from"../equivalent-to.js";import{is_basic_identifier_string,JS_Parse_Error,parse,PRECEDENCE}from"../parse.js";import{OutputStream}from"../output.js";import{base54,format_mangler_options}from"../scope.js";import"../size.js";import"./evaluate.js";import"./drop-side-effect-free.js";import"./drop-unused.js";import"./reduce-vars.js";import{is_undeclared_ref,bitwise_binop,lazy_op,is_nullish,is_undefined,is_lhs,aborts,is_used_in_expression}from"./inference.js";import{SQUEEZED,OPTIMIZED,CLEAR_BETWEEN_PASSES,TOP,UNDEFINED,UNUSED,TRUTHY,FALSY,has_flag,set_flag,clear_flag}from"./compressor-flags.js";import{make_sequence,best_of,best_of_expression,make_empty_function,make_node_from_constant,merge_sequence,get_simple_key,has_break_or_continue,maintain_this_binding,is_empty,is_identifier_atom,is_reachable,can_be_evicted_from_block,as_statement_array,is_func_expr}from"./common.js";import{tighten_body,trim_unreachable_code}from"./tighten-body.js";import{inline_into_symbolref,inline_into_call}from"./inline.js";import"./global-defs.js";class Compressor extends TreeWalker{constructor(e,{false_by_default:t=!1,mangle_options:n=!1}){super(),void 0===e.defaults||e.defaults||(t=!0),this.options=defaults(e,{arguments:!1,arrows:!t,booleans:!t,booleans_as_integers:!1,collapse_vars:!t,comparisons:!t,computed_props:!t,conditionals:!t,dead_code:!t,defaults:!0,directives:!t,drop_console:!1,drop_debugger:!t,ecma:5,evaluate:!t,expression:!1,global_defs:!1,hoist_funs:!1,hoist_props:!t,hoist_vars:!1,ie8:!1,if_return:!t,inline:!t,join_vars:!t,keep_classnames:!1,keep_fargs:!0,keep_fnames:!1,keep_infinity:!1,lhs_constants:!t,loops:!t,module:!1,negate_iife:!t,passes:1,properties:!t,pure_getters:!t&&"strict",pure_funcs:null,pure_new:!1,reduce_funcs:!t,reduce_vars:!t,sequences:!t,side_effects:!t,switches:!t,top_retain:null,toplevel:!(!e||!e.top_retain),typeofs:!t,unsafe:!1,unsafe_arrows:!1,unsafe_comps:!1,unsafe_Function:!1,unsafe_math:!1,unsafe_symbols:!1,unsafe_methods:!1,unsafe_proto:!1,unsafe_regexp:!1,unsafe_undefined:!1,unused:!t,warnings:!1},!0);var o=this.options.global_defs;if("object"==typeof o)for(var i in o)"@"===i[0]&&HOP(o,i)&&(o[i.slice(1)]=parse(o[i],{expression:!0}));!0===this.options.inline&&(this.options.inline=3);var r=this.options.pure_funcs;this.pure_funcs="function"==typeof r?r:r?function(e){return!r.includes(e.expression.print_to_string())}:return_true;var a=this.options.top_retain;a instanceof RegExp?this.top_retain=function(e){return a.test(e.name)}:"function"==typeof a?this.top_retain=a:a&&("string"==typeof a&&(a=a.split(/,/)),this.top_retain=function(e){return a.includes(e.name)}),this.options.module&&(this.directives["use strict"]=!0,this.options.toplevel=!0);var s=this.options.toplevel;this.toplevel="string"==typeof s?{funcs:/funcs/.test(s),vars:/vars/.test(s)}:{funcs:s,vars:s};var _=this.options.sequences;this.sequences_limit=1==_?800:0|_,this.evaluated_regexps=new Map,this._toplevel=void 0,this._mangle_options=n?format_mangler_options(n):n}mangle_options(){var e=this._mangle_options&&this._mangle_options.nth_identifier||base54,t=this._mangle_options&&this._mangle_options.module||this.option("module");return{ie8:this.option("ie8"),nth_identifier:e,module:t}}option(e){return this.options[e]}exposed(e){if(e.export)return!0;if(e.global)for(var t=0,n=e.orig.length;t<n;t++)if(!this.toplevel[e.orig[t]instanceof AST_SymbolDefun?"funcs":"vars"])return!0;return!1}in_boolean_context(){if(!this.option("booleans"))return!1;for(var e,t=this.self(),n=0;e=this.parent(n);n++){if(e instanceof AST_SimpleStatement||e instanceof AST_Conditional&&e.condition===t||e instanceof AST_DWLoop&&e.condition===t||e instanceof AST_For&&e.condition===t||e instanceof AST_If&&e.condition===t||e instanceof AST_UnaryPrefix&&"!"==e.operator&&e.expression===t)return!0;if(!(e instanceof AST_Binary&&("&&"==e.operator||"||"==e.operator||"??"==e.operator)||e instanceof AST_Conditional||e.tail_node()===t))return!1;t=e}}in_32_bit_context(e){if(!this.option("evaluate"))return!1;for(var t,n=this.self(),o=0;t=this.parent(o);o++){if(t instanceof AST_Binary&&bitwise_binop.has(t.operator))return!e||(n===t.left?t.right:t.left).is_number(this);if(t instanceof AST_UnaryPrefix)return"~"===t.operator;if(!(t instanceof AST_Binary&&("&&"==t.operator||"||"==t.operator||"??"==t.operator)||t instanceof AST_Conditional&&t.condition!==n||t.tail_node()===n))return!1;n=t}}in_computed_key(){if(!this.option("evaluate"))return!1;for(var e,t=this.self(),n=0;e=this.parent(n);n++)if(e instanceof AST_ObjectProperty&&e.key===t)return!0;return!1}get_toplevel(){return this._toplevel}compress(e){e=e.resolve_defines(this),this._toplevel=e,this.option("expression")&&this._toplevel.process_expression(!0);for(var t=+this.options.passes||1,n=1/0,o=!1,i=this.mangle_options(),r=0;r<t;r++)if(this._toplevel.figure_out_scope(i),0===r&&this.option("drop_console")&&(this._toplevel=this._toplevel.drop_console(this.option("drop_console"))),(r>0||this.option("reduce_vars"))&&this._toplevel.reset_opt_flags(this),this._toplevel=this._toplevel.transform(this),t>1){let e=0;if(walk(this._toplevel,()=>{e++}),e<n)n=e,o=!1;else{if(o)break;o=!0}}return this.option("expression")&&this._toplevel.process_expression(!1),e=this._toplevel,this._toplevel=void 0,e}before(e,t){if(has_flag(e,SQUEEZED))return e;var n=!1;e instanceof AST_Scope&&(e=(e=e.hoist_properties(this)).hoist_declarations(this),n=!0),t(e,this),t(e,this);var o=e.optimize(this);return n&&o instanceof AST_Scope&&(o.drop_unused(this),t(o,this)),o===e&&set_flag(o,SQUEEZED),o}is_lhs(){const e=this.stack[this.stack.length-1],t=this.stack[this.stack.length-2];return is_lhs(e,t)}}function def_optimize(e,t){e.DEFMETHOD("optimize",function(e){var n=this;if(has_flag(n,OPTIMIZED))return n;if(e.has_directive("use asm"))return n;var o=t(n,e);return set_flag(o,OPTIMIZED),o})}function find_variable(e,t){for(var n,o=0;(n=e.parent(o++))&&!(n instanceof AST_Scope);)if(n instanceof AST_Catch&&n.argname){n=n.argname.definition().scope;break}return n.find_variable(t)}def_optimize(AST_Node,function(e){return e}),AST_Toplevel.DEFMETHOD("drop_console",function(e){const t=Array.isArray(e),n=new TreeTransformer(function(o){if("Call"===o.TYPE){var i=o.expression;if(i instanceof AST_PropAccess){for(var r=i.expression,a=i.property,s=2;r.expression;)a=r.property,r=r.expression,s++;if((!t||e.includes(a))&&is_undeclared_ref(r)&&"console"==r.name){if(3!==s||["call","apply"].includes(i.property)||!is_used_in_expression(n))return make_node(AST_Undefined,o);i.expression=make_empty_function(o),set_flag(i.expression,SQUEEZED),o.args=[]}}}});return this.transform(n)}),AST_Node.DEFMETHOD("equivalent_to",function(e){return equivalent_to(this,e)}),AST_Scope.DEFMETHOD("process_expression",function(e,t){var n=this,o=new TreeTransformer(function(i){if(e&&i instanceof AST_SimpleStatement)return make_node(AST_Return,i,{value:i.body});if(!e&&i instanceof AST_Return){if(t){var r=i.value&&i.value.drop_side_effect_free(t,!0);return r?make_node(AST_SimpleStatement,i,{body:r}):make_node(AST_EmptyStatement,i)}return make_node(AST_SimpleStatement,i,{body:i.value||make_node(AST_UnaryPrefix,i,{operator:"void",expression:make_node(AST_Number,i,{value:0})})})}if(i instanceof AST_Class||i instanceof AST_Lambda&&i!==n)return i;if(i instanceof AST_Block){var a=i.body.length-1;a>=0&&(i.body[a]=i.body[a].transform(o))}else i instanceof AST_If?(i.body=i.body.transform(o),i.alternative&&(i.alternative=i.alternative.transform(o))):i instanceof AST_With&&(i.body=i.body.transform(o));return i});n.transform(o)}),AST_Toplevel.DEFMETHOD("reset_opt_flags",function(e){const t=this,n=e.option("reduce_vars"),o=new TreeWalker(function(i,r){if(clear_flag(i,CLEAR_BETWEEN_PASSES),n)return e.top_retain&&i instanceof AST_Defun&&o.parent()===t&&set_flag(i,TOP),i.reduce_vars(o,r,e)});o.safe_ids=Object.create(null),o.in_loop=null,o.loop_ids=new Map,o.defs_to_safe_ids=new Map,t.walk(o)}),AST_Symbol.DEFMETHOD("fixed_value",function(){var e=this.thedef.fixed;return!e||e instanceof AST_Node?e:e()}),AST_SymbolRef.DEFMETHOD("is_immutable",function(){var e=this.definition().orig;return 1==e.length&&e[0]instanceof AST_SymbolLambda});var global_names=makePredicate("Array Boolean clearInterval clearTimeout console Date decodeURI decodeURIComponent encodeURI encodeURIComponent Error escape eval EvalError Function isFinite isNaN JSON Math Number parseFloat parseInt RangeError ReferenceError RegExp Object setInterval setTimeout String SyntaxError TypeError unescape URIError");AST_SymbolRef.DEFMETHOD("is_declared",function(e){return!this.definition().undeclared||e.option("unsafe")&&global_names.has(this.name)});var directives=new Set(["use asm","use strict"]);function can_be_extracted_from_if_block(e){return!(e instanceof AST_Const||e instanceof AST_Let||e instanceof AST_Using||e instanceof AST_Class)}function opt_AST_Lambda(e,t){return tighten_body(e.body,t),t.option("side_effects")&&1==e.body.length&&e.body[0]===t.has_directive("use strict")&&(e.body.length=0),e}function if_break_in_loop(e,t){var n=e.body instanceof AST_BlockStatement?e.body.body[0]:e.body;if(t.option("dead_code")&&i(n)){var o=[];return e.init instanceof AST_Statement?o.push(e.init):e.init&&o.push(make_node(AST_SimpleStatement,e.init,{body:e.init})),e.condition&&o.push(make_node(AST_SimpleStatement,e.condition,{body:e.condition})),trim_unreachable_code(t,e.body,o),make_node(AST_BlockStatement,e,{body:o})}return n instanceof AST_If&&(i(n.body)?(e.condition?e.condition=make_node(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:n.condition.negate(t)}):e.condition=n.condition.negate(t),r(n.alternative)):i(n.alternative)&&(e.condition?e.condition=make_node(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:n.condition}):e.condition=n.condition,r(n.body))),e;function i(e){return e instanceof AST_Break&&t.loopcontrol_target(e)===t.self()}function r(n){n=as_statement_array(n),e.body instanceof AST_BlockStatement?(e.body=e.body.clone(),e.body.body=n.concat(e.body.body.slice(1)),e.body=e.body.transform(t)):e.body=make_node(AST_BlockStatement,e.body,{body:n}).transform(t),e=if_break_in_loop(e,t)}}def_optimize(AST_Directive,function(e,t){return!t.option("directives")||directives.has(e.value)&&t.has_directive(e.value)===e?e:make_node(AST_EmptyStatement,e)}),def_optimize(AST_Debugger,function(e,t){return t.option("drop_debugger")?make_node(AST_EmptyStatement,e):e}),def_optimize(AST_LabeledStatement,function(e,t){return e.body instanceof AST_Break&&t.loopcontrol_target(e.body)===e.body?make_node(AST_EmptyStatement,e):0==e.label.references.length?e.body:e}),def_optimize(AST_Block,function(e,t){return tighten_body(e.body,t),e}),def_optimize(AST_BlockStatement,function(e,t){switch(tighten_body(e.body,t),e.body.length){case 1:if(!t.has_directive("use strict")&&t.parent()instanceof AST_If&&can_be_extracted_from_if_block(e.body[0])||can_be_evicted_from_block(e.body[0]))return e.body[0];break;case 0:return make_node(AST_EmptyStatement,e)}return e}),def_optimize(AST_Lambda,opt_AST_Lambda),AST_Scope.DEFMETHOD("hoist_declarations",function(e){var t=this;if(e.has_directive("use asm"))return t;var n=e.option("hoist_funs"),o=e.option("hoist_vars");if(n||o){var i=[],r=[],a=new Map,s=0,_=0;walk(t,e=>e instanceof AST_Scope&&e!==t||(e instanceof AST_Var?(++_,!0):void 0)),o=o&&_>1;var f=new TreeTransformer(function(_){if(_!==t){if(_ instanceof AST_Directive)return i.push(_),make_node(AST_EmptyStatement,_);if(n&&_ instanceof AST_Defun&&!(f.parent()instanceof AST_Export)&&f.parent()===t)return r.push(_),make_node(AST_EmptyStatement,_);if(o&&_ instanceof AST_Var&&!_.definitions.some(e=>e.name instanceof AST_Destructuring)){_.definitions.forEach(function(e){a.set(e.name.name,e),++s});var l=_.to_assignments(e),c=f.parent();if(c instanceof AST_ForIn&&c.init===_){if(null==l){var p=_.definitions[0].name;return make_node(AST_SymbolRef,p,p)}return l}return c instanceof AST_For&&c.init===_?l:l?make_node(AST_SimpleStatement,_,{body:l}):make_node(AST_EmptyStatement,_)}if(_ instanceof AST_Scope)return _}});if(t=t.transform(f),s>0){var l=[];const e=t instanceof AST_Lambda,n=e?t.args_as_names():null;if(a.forEach((t,o)=>{e&&n.some(e=>e.name===t.name.name)?a.delete(o):((t=t.clone()).value=null,l.push(t),a.set(o,t))}),l.length>0){for(;0<t.body.length;){if(t.body[0]instanceof AST_SimpleStatement){var c,p,u=t.body[0].body;if(u instanceof AST_Assign&&"="==u.operator&&(c=u.left)instanceof AST_Symbol&&a.has(c.name)){if((d=a.get(c.name)).value)break;d.value=u.right,remove(l,d),l.push(d),t.body.splice(0,1);continue}if(u instanceof AST_Sequence&&(p=u.expressions[0])instanceof AST_Assign&&"="==p.operator&&(c=p.left)instanceof AST_Symbol&&a.has(c.name)){var d;if((d=a.get(c.name)).value)break;d.value=p.right,remove(l,d),l.push(d),t.body[0].body=make_sequence(u,u.expressions.slice(1));continue}}if(t.body[0]instanceof AST_EmptyStatement)t.body.splice(0,1);else{if(!(t.body[0]instanceof AST_BlockStatement))break;t.body.splice(0,1,...t.body[0].body)}}l=make_node(AST_Var,t,{definitions:l}),r.push(l)}}t.body=i.concat(r,t.body)}return t}),AST_Scope.DEFMETHOD("hoist_properties",function(e){var t=this;if(!e.option("hoist_props")||e.has_directive("use asm"))return t;var n=t instanceof AST_Toplevel&&e.top_retain||return_false,o=new Map,i=new TreeTransformer(function(r,a){if(r instanceof AST_VarDef){const s=r.name;let _,f;if(!(s.scope!==t||s instanceof AST_SymbolUsing||1==(_=s.definition()).escaped||_.assignments||_.direct_access||_.single_use||e.exposed(_)||n(_)||(f=s.fixed_value())!==r.value||!(f instanceof AST_Object)||f.properties.some(e=>e instanceof AST_Expansion||e.computed_key()))){a(r,this);const e=new Map,n=[];return f.properties.forEach(({key:o,value:a})=>{const _=i.find_scope(),f=t.create_symbol(s.CTOR,{source:s,scope:_,conflict_scopes:new Set([_,...s.definition().references.map(e=>e.scope)]),tentative_name:s.name+"_"+o});e.set(String(o),f.definition()),n.push(make_node(AST_VarDef,r,{name:f,value:a}))}),o.set(_.id,e),MAP.splice(n)}}else if(r instanceof AST_PropAccess&&r.expression instanceof AST_SymbolRef){const e=o.get(r.expression.definition().id);if(e){const t=e.get(String(get_simple_key(r.property))),n=make_node(AST_SymbolRef,r,{name:t.name,scope:r.expression.scope,thedef:t});return n.reference({}),n}}});return t.transform(i)}),def_optimize(AST_SimpleStatement,function(e,t){if(t.option("side_effects")){var n=e.body,o=n.drop_side_effect_free(t,!0);if(!o)return make_node(AST_EmptyStatement,e);if(o!==n)return make_node(AST_SimpleStatement,e,{body:o})}return e}),def_optimize(AST_While,function(e,t){return t.option("loops")?make_node(AST_For,e,e).optimize(t):e}),def_optimize(AST_Do,function(e,t){if(!t.option("loops"))return e;var n=e.condition.tail_node().evaluate(t);if(!(n instanceof AST_Node)){if(n)return make_node(AST_For,e,{body:make_node(AST_BlockStatement,e.body,{body:[e.body,make_node(AST_SimpleStatement,e.condition,{body:e.condition})]})}).optimize(t);if(!has_break_or_continue(e,t.parent()))return make_node(AST_BlockStatement,e.body,{body:[e.body,make_node(AST_SimpleStatement,e.condition,{body:e.condition})]}).optimize(t)}return e}),def_optimize(AST_For,function(e,t){if(!t.option("loops"))return e;if(t.option("side_effects")&&e.init&&(e.init=e.init.drop_side_effect_free(t)),e.condition){var n=e.condition.evaluate(t);if(!(n instanceof AST_Node))if(n)e.condition=null;else if(!t.option("dead_code")){var o=e.condition;e.condition=make_node_from_constant(n,e.condition),e.condition=best_of_expression(e.condition.transform(t),o)}if(t.option("dead_code")&&(n instanceof AST_Node&&(n=e.condition.tail_node().evaluate(t)),!n)){var i=[];return trim_unreachable_code(t,e.body,i),e.init instanceof AST_Statement?i.push(e.init):e.init&&i.push(make_node(AST_SimpleStatement,e.init,{body:e.init})),i.push(make_node(AST_SimpleStatement,e.condition,{body:e.condition})),make_node(AST_BlockStatement,e,{body:i}).optimize(t)}}return if_break_in_loop(e,t)}),def_optimize(AST_If,function(e,t){if(is_empty(e.alternative)&&(e.alternative=null),!t.option("conditionals"))return e;var n=e.condition.evaluate(t);if(!(t.option("dead_code")||n instanceof AST_Node)){var o=e.condition;e.condition=make_node_from_constant(n,o),e.condition=best_of_expression(e.condition.transform(t),o)}if(t.option("dead_code")){if(n instanceof AST_Node&&(n=e.condition.tail_node().evaluate(t)),!n){var i=[];return trim_unreachable_code(t,e.body,i),i.push(make_node(AST_SimpleStatement,e.condition,{body:e.condition})),e.alternative&&i.push(e.alternative),make_node(AST_BlockStatement,e,{body:i}).optimize(t)}if(!(n instanceof AST_Node))return(i=[]).push(make_node(AST_SimpleStatement,e.condition,{body:e.condition})),i.push(e.body),e.alternative&&trim_unreachable_code(t,e.alternative,i),make_node(AST_BlockStatement,e,{body:i}).optimize(t)}var r=e.condition.negate(t),a=e.condition.size(),s=r.size(),_=s<a;if(e.alternative&&_){_=!1,e.condition=r;var f=e.body;e.body=e.alternative||make_node(AST_EmptyStatement,e),e.alternative=f}if(is_empty(e.body)&&is_empty(e.alternative))return make_node(AST_SimpleStatement,e.condition,{body:e.condition.clone()}).optimize(t);if(e.body instanceof AST_SimpleStatement&&e.alternative instanceof AST_SimpleStatement)return make_node(AST_SimpleStatement,e,{body:make_node(AST_Conditional,e,{condition:e.condition,consequent:e.body.body,alternative:e.alternative.body})}).optimize(t);if(is_empty(e.alternative)&&e.body instanceof AST_SimpleStatement)return a===s&&!_&&e.condition instanceof AST_Binary&&"||"==e.condition.operator&&(_=!0),_?make_node(AST_SimpleStatement,e,{body:make_node(AST_Binary,e,{operator:"||",left:r,right:e.body.body})}).optimize(t):make_node(AST_SimpleStatement,e,{body:make_node(AST_Binary,e,{operator:"&&",left:e.condition,right:e.body.body})}).optimize(t);if(e.body instanceof AST_EmptyStatement&&e.alternative instanceof AST_SimpleStatement)return make_node(AST_SimpleStatement,e,{body:make_node(AST_Binary,e,{operator:"||",left:e.condition,right:e.alternative.body})}).optimize(t);if(e.body instanceof AST_Exit&&e.alternative instanceof AST_Exit&&e.body.TYPE==e.alternative.TYPE)return make_node(e.body.CTOR,e,{value:make_node(AST_Conditional,e,{condition:e.condition,consequent:e.body.value||make_node(AST_Undefined,e.body),alternative:e.alternative.value||make_node(AST_Undefined,e.alternative)}).transform(t)}).optimize(t);if(e.body instanceof AST_If&&!e.body.alternative&&!e.alternative&&(e=make_node(AST_If,e,{condition:make_node(AST_Binary,e.condition,{operator:"&&",left:e.condition,right:e.body.condition}),body:e.body.body,alternative:null})),aborts(e.body)&&e.alternative){var l=e.alternative;return e.alternative=null,make_node(AST_BlockStatement,e,{body:[e,l]}).optimize(t)}if(aborts(e.alternative)){i=e.body;return e.body=e.alternative,e.condition=_?r:e.condition.negate(t),e.alternative=null,make_node(AST_BlockStatement,e,{body:[e,i]}).optimize(t)}return e}),def_optimize(AST_Switch,function(e,t){if(!t.option("switches"))return e;var n,o=e.expression.evaluate(t);if(!(o instanceof AST_Node)){var i=e.expression;e.expression=make_node_from_constant(o,i),e.expression=best_of_expression(e.expression.transform(t),i)}if(!t.option("dead_code"))return e;o instanceof AST_Node&&(o=e.expression.tail_node().evaluate(t));for(var r,a,s=[],_=[],f=0,l=e.body.length;f<l&&!a;f++){if((n=e.body[f])instanceof AST_Default)r?d(n,_[_.length-1]):r=n;else if(!(o instanceof AST_Node)){var c=n.expression.evaluate(t);if(!(c instanceof AST_Node)&&c!==o){d(n,_[_.length-1]);continue}if(c instanceof AST_Node&&!c.has_side_effects(t)&&(c=n.expression.tail_node().evaluate(t)),c===o&&(a=n,r)){var p=_.indexOf(r);_.splice(p,1),d(r,_[p-1]),r=null}}_.push(n)}for(;f<l;)d(e.body[f++],_[_.length-1]);e.body=_;let u=r||a;if(r=null,a=null,_.every((e,t)=>(e===u||e.expression instanceof AST_Constant)&&(0===e.body.length||aborts(e)||_.length-1===t)))for(let e=0;e<_.length;e++){const t=_[e];for(let n=e+1;n<_.length;n++){const o=_[n];if(0===o.body.length)continue;const i=n===_.length-1,r=m(o,t,!1);if(r||i&&m(o,t,!0)){!r&&i&&o.body.push(make_node(AST_Break));let t=n-1,a=0;for(;t>e&&g(_[t--]);)a++;const s=_.splice(n-a,1+a);_.splice(e+1,0,...s),e+=s.length}}}for(let e=0;e<_.length;e++){let t=_[e];if(0!==t.body.length&&aborts(t))for(let n=e+1;n<_.length;e++,n++){let e=_[n];if(0!==e.body.length){if(!(m(e,t,!1)||n===_.length-1&&m(e,t,!0)))break;t.body=[],t=e}}}{let e=_.length-1;for(;e>=0;e--){let n=_[e].body;if(A(n[n.length-1],t)&&n.pop(),!g(_[e]))break}if(e++,!u||_.indexOf(u)>=e)for(let n=_.length-1;n>=e;n--){let e=_[n];if(e===u)u=null,_.pop();else{if(e.expression.has_side_effects(t))break;_.pop()}}}e:if(u){let e=_.indexOf(u),n=e;for(;n<_.length-1&&g(_[n]);n++);if(n<_.length-1)break e;let o=_.length-1;for(;o>=0;o--){let e=_[o];if(e!==u&&e.expression.has_side_effects(t))break}if(n>o){let t=e-1;for(;t>=0&&g(_[t]);t--);let i=Math.max(o,t)+1,r=e;o>e?(r=o,_[o].body=_[n].body):u.body=_[n].body,_.splice(r+1,n-r),_.splice(i,e-i)}}e:if(u){let n,o=_.findIndex(e=>!g(e));if(o===_.length-1){let t=_[o];if(T(e))break e;n=make_node(AST_BlockStatement,t,{body:t.body}),t.body=[]}else if(-1!==o)break e;let i=_.find(e=>e!==u&&e.expression.has_side_effects(t));if(!i)return make_node(AST_BlockStatement,e,{body:s.concat(S(e.expression),u.expression?S(u.expression):[],n||[])}).optimize(t);const r=_.indexOf(u);if(_.splice(r,1),u=null,n)return make_node(AST_BlockStatement,e,{body:s.concat(e,n)}).optimize(t)}if(_.length>0&&(_[0].body=s.concat(_[0].body)),0==_.length)return make_node(AST_BlockStatement,e,{body:s.concat(S(e.expression))}).optimize(t);if(1==_.length&&!T(e)){let n=_[0];return make_node(AST_If,e,{condition:make_node(AST_Binary,e,{operator:"===",left:e.expression,right:n.expression}),body:make_node(AST_BlockStatement,n,{body:n.body}),alternative:null}).optimize(t)}if(2===_.length&&u&&!T(e)){let n=_[0]===u?_[1]:_[0],o=u.expression&&S(u.expression);if(aborts(_[0])){let i=_[0];return A(i.body[i.body.length-1],t)&&i.body.pop(),make_node(AST_If,e,{condition:make_node(AST_Binary,e,{operator:"===",left:e.expression,right:n.expression}),body:make_node(AST_BlockStatement,n,{body:n.body}),alternative:make_node(AST_BlockStatement,u,{body:[].concat(o||[],u.body)})}).optimize(t)}let i="===",r=make_node(AST_BlockStatement,n,{body:n.body}),a=make_node(AST_BlockStatement,u,{body:[].concat(o||[],u.body)});if(_[0]===u){i="!==";let e=a;a=r,r=e}return make_node(AST_BlockStatement,e,{body:[make_node(AST_If,e,{condition:make_node(AST_Binary,e,{operator:i,left:e.expression,right:n.expression}),body:r,alternative:null}),a]}).optimize(t)}return e;function d(e,n){n&&!aborts(n)?n.body=n.body.concat(e.body):trim_unreachable_code(t,e,s)}function m(e,t,n){let o=e.body,i=t.body;if(n&&(o=o.concat(make_node(AST_Break))),o.length!==i.length)return!1;let r=make_node(AST_BlockStatement,e,{body:o}),a=make_node(AST_BlockStatement,t,{body:i});return r.equivalent_to(a)}function S(e){return make_node(AST_SimpleStatement,e,{body:e})}function T(e){let t=!1,n=new TreeWalker(e=>{if(t)return!0;if(e instanceof AST_Lambda)return!0;if(e instanceof AST_SimpleStatement)return!0;if(!A(e,n))return;let o=n.parent();o instanceof AST_SwitchBranch&&o.body[o.body.length-1]===e||(t=!0)});return e.walk(n),t}function A(t,n){return t instanceof AST_Break&&n.loopcontrol_target(t)===e}function g(e){return!aborts(e)&&!make_node(AST_BlockStatement,e,{body:e.body}).has_side_effects(t)}}),def_optimize(AST_Try,function(e,t){if(e.bcatch&&e.bfinally&&e.bfinally.body.every(is_empty)&&(e.bfinally=null),t.option("dead_code")&&e.body.body.every(is_empty)){var n=[];return e.bcatch&&trim_unreachable_code(t,e.bcatch,n),e.bfinally&&n.push(...e.bfinally.body),make_node(AST_BlockStatement,e,{body:n}).optimize(t)}return e}),AST_Definitions.DEFMETHOD("to_assignments",function(e){var t=e.option("reduce_vars"),n=[];for(const e of this.definitions){if(e.value){var o=make_node(AST_SymbolRef,e.name,e.name);n.push(make_node(AST_Assign,e,{operator:"=",logical:!1,left:o,right:e.value})),t&&(o.definition().fixed=!1)}const i=e.name.definition();i.eliminated++,i.replaced--}return 0==n.length?null:make_sequence(this,n)}),def_optimize(AST_Definitions,function(e){return 0==e.definitions.length?make_node(AST_EmptyStatement,e):e}),def_optimize(AST_VarDef,function(e,t){return e.name instanceof AST_SymbolLet&&null!=e.value&&is_undefined(e.value,t)&&(e.value=null),e}),def_optimize(AST_Import,function(e){return e}),def_optimize(AST_Call,function(e,t){var n=e.expression,o=n;inline_array_like_spread(e.args);var i=e.args.every(e=>!(e instanceof AST_Expansion));t.option("reduce_vars")&&o instanceof AST_SymbolRef&&(o=o.fixed_value());var r=o instanceof AST_Lambda;if(r&&o.pinned())return e;if(t.option("unused")&&i&&r&&!o.uses_arguments){for(var a=0,s=0,_=0,f=e.args.length;_<f;_++){if(o.argnames[_]instanceof AST_Expansion){if(has_flag(o.argnames[_].expression,UNUSED))for(;_<f;){(A=e.args[_++].drop_side_effect_free(t))&&(e.args[a++]=A)}else for(;_<f;)e.args[a++]=e.args[_++];s=a;break}var l=_>=o.argnames.length;if(l||has_flag(o.argnames[_],UNUSED)){if(A=e.args[_].drop_side_effect_free(t))e.args[a++]=A;else if(!l){e.args[a++]=make_node(AST_Number,e.args[_],{value:0});continue}}else e.args[a++]=e.args[_];s=a}e.args.length=s}if(n instanceof AST_Dot&&n.expression instanceof AST_SymbolRef&&"console"===n.expression.name&&n.expression.definition().undeclared&&"assert"===n.property){const n=e.args[0];if(n){const o=n.evaluate(t);if(1===o||!0===o)return make_node(AST_Undefined,e)}}if(t.option("unsafe")&&!n.contains_optional()){if(n instanceof AST_Dot&&"Array"===n.start.value&&"from"===n.property&&1===e.args.length){const[n]=e.args;if(n instanceof AST_Array)return make_node(AST_Array,n,{elements:n.elements}).optimize(t)}if(is_undeclared_ref(n))switch(n.name){case"Array":if(1!=e.args.length)return make_node(AST_Array,e,{elements:e.args}).optimize(t);if(e.args[0]instanceof AST_Number&&e.args[0].value<=11){const t=[];for(let n=0;n<e.args[0].value;n++)t.push(new AST_Hole);return new AST_Array({elements:t})}break;case"Object":if(0==e.args.length)return make_node(AST_Object,e,{properties:[]});break;case"String":if(0==e.args.length)return make_node(AST_String,e,{value:""});if(e.args.length<=1)return make_node(AST_Binary,e,{left:e.args[0],operator:"+",right:make_node(AST_String,e,{value:""})}).optimize(t);break;case"Number":if(0==e.args.length)return make_node(AST_Number,e,{value:0});if(1==e.args.length&&t.option("unsafe_math"))return make_node(AST_UnaryPrefix,e,{expression:e.args[0],operator:"+"}).optimize(t);break;case"Symbol":1==e.args.length&&e.args[0]instanceof AST_String&&t.option("unsafe_symbols")&&(e.args.length=0);break;case"Boolean":if(0==e.args.length)return make_node(AST_False,e);if(1==e.args.length)return make_node(AST_UnaryPrefix,e,{expression:make_node(AST_UnaryPrefix,e,{expression:e.args[0],operator:"!"}),operator:"!"}).optimize(t);break;case"RegExp":var c=[];if(e.args.length>=1&&e.args.length<=2&&e.args.every(e=>{var n=e.evaluate(t);return c.push(n),e!==n})&&regexp_is_safe(c[0])){let[n,o]=c;n=regexp_source_fix(new RegExp(n).source);const i=make_node(AST_RegExp,e,{value:{source:n,flags:o}});if(i._eval(t)!==i)return i}}else if(n instanceof AST_Dot)switch(n.property){case"toString":if(0==e.args.length&&!n.expression.may_throw_on_access(t))return make_node(AST_Binary,e,{left:make_node(AST_String,e,{value:""}),operator:"+",right:n.expression}).optimize(t);break;case"join":if(n.expression instanceof AST_Array)e:{var p;if(!(e.args.length>0&&(p=e.args[0].evaluate(t))===e.args[0])){var u,d=[],m=[];for(_=0,f=n.expression.elements.length;_<f;_++){var S=n.expression.elements[_];if(S instanceof AST_Expansion)break e;var T=S.evaluate(t);T!==S?m.push(T):(m.length>0&&(d.push(make_node(AST_String,e,{value:m.join(p)})),m.length=0),d.push(S))}return m.length>0&&d.push(make_node(AST_String,e,{value:m.join(p)})),0==d.length?make_node(AST_String,e,{value:""}):1==d.length?d[0].is_string(t)?d[0]:make_node(AST_Binary,d[0],{operator:"+",left:make_node(AST_String,e,{value:""}),right:d[0]}):""==p?(u=d[0].is_string(t)||d[1].is_string(t)?d.shift():make_node(AST_String,e,{value:""}),d.reduce(function(e,t){return make_node(AST_Binary,t,{operator:"+",left:e,right:t})},u).optimize(t)):((A=e.clone()).expression=A.expression.clone(),A.expression.expression=A.expression.expression.clone(),A.expression.expression.elements=d,best_of(t,e,A));var A}}break;case"charAt":if(n.expression.is_string(t)){var g=e.args[0],h=g?g.evaluate(t):0;if(h!==g)return make_node(AST_Sub,n,{expression:n.expression,property:make_node_from_constant(0|h,g||n)}).optimize(t)}break;case"apply":if(2==e.args.length&&e.args[1]instanceof AST_Array){var y=e.args[1].elements.slice();return y.unshift(e.args[0]),make_node(AST_Call,e,{expression:make_node(AST_Dot,n,{expression:n.expression,optional:!1,property:"call"}),args:y}).optimize(t)}break;case"call":var b=n.expression;if(b instanceof AST_SymbolRef&&(b=b.fixed_value()),b instanceof AST_Lambda&&!b.contains_this())return(e.args.length?make_sequence(this,[e.args[0],make_node(AST_Call,e,{expression:n.expression,args:e.args.slice(1)})]):make_node(AST_Call,e,{expression:n.expression,args:[]})).optimize(t)}}if(t.option("unsafe_Function")&&is_undeclared_ref(n)&&"Function"==n.name){if(0==e.args.length)return make_empty_function(e).optimize(t);if(e.args.every(e=>e instanceof AST_String))try{var v="n(function("+e.args.slice(0,-1).map(function(e){return e.value}).join(",")+"){"+e.args[e.args.length-1].value+"})",k=parse(v),x=t.mangle_options();k.figure_out_scope(x);var E,B=new Compressor(t.options,{mangle_options:t._mangle_options});(k=k.transform(B)).figure_out_scope(x),k.compute_char_frequency(x),k.mangle_names(x),walk(k,e=>{if(is_func_expr(e))return E=e,walk_abort});v=OutputStream();return AST_BlockStatement.prototype._codegen.call(E,E,v),e.args=[make_node(AST_String,e,{value:E.argnames.map(function(e){return e.print_to_string()}).join(",")}),make_node(AST_String,e.args[e.args.length-1],{value:v.get().replace(/^{|}$/g,"")})],e}catch(e){if(!(e instanceof JS_Parse_Error))throw e}}return inline_into_call(e,t)}),AST_Node.DEFMETHOD("contains_optional",function(){return(this instanceof AST_PropAccess||this instanceof AST_Call||this instanceof AST_Chain)&&(!!this.optional||this.expression.contains_optional())}),def_optimize(AST_New,function(e,t){return t.option("unsafe")&&is_undeclared_ref(e.expression)&&["Object","RegExp","Function","Error","Array"].includes(e.expression.name)?make_node(AST_Call,e,e).transform(t):e}),def_optimize(AST_Sequence,function(e,t){if(!t.option("side_effects"))return e;var n,o,i=[];n=first_in_statement(t),o=e.expressions.length-1,e.expressions.forEach(function(e,r){r<o&&(e=e.drop_side_effect_free(t,n)),e&&(merge_sequence(i,e),n=!1)});var r=i.length-1;return function(){for(;r>0&&is_undefined(i[r],t);)r--;r<i.length-1&&(i[r]=make_node(AST_UnaryPrefix,e,{operator:"void",expression:i[r]}),i.length=r+1)}(),0==r?((e=maintain_this_binding(t.parent(),t.self(),i[0]))instanceof AST_Sequence||(e=e.optimize(t)),e):(e.expressions=i,e)}),AST_Unary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")&&this.expression instanceof AST_Sequence){var t=this.expression.expressions.slice(),n=this.clone();return n.expression=t.pop(),t.push(n),make_sequence(this,t).optimize(e)}return this}),def_optimize(AST_UnaryPostfix,function(e,t){return e.lift_sequences(t)}),def_optimize(AST_UnaryPrefix,function(e,t){var n=e.expression;if("delete"==e.operator&&!(n instanceof AST_SymbolRef||n instanceof AST_PropAccess||n instanceof AST_Chain||is_identifier_atom(n)))return make_sequence(e,[n,make_node(AST_True,e)]).optimize(t);var o=e.lift_sequences(t);if(o!==e)return o;if(t.option("side_effects")&&"void"==e.operator)return(n=n.drop_side_effect_free(t))?(e.expression=n,e):make_node(AST_Undefined,e).optimize(t);if(t.in_boolean_context())switch(e.operator){case"!":if(n instanceof AST_UnaryPrefix&&"!"==n.operator)return n.expression;n instanceof AST_Binary&&(e=best_of(t,e,n.negate(t,first_in_statement(t))));break;case"typeof":return(n instanceof AST_SymbolRef?make_node(AST_True,e):make_sequence(e,[n,make_node(AST_True,e)])).optimize(t)}if("-"==e.operator&&n instanceof AST_Infinity&&(n=n.transform(t)),n instanceof AST_Binary&&("+"==e.operator||"-"==e.operator)&&("*"==n.operator||"/"==n.operator||"%"==n.operator))return make_node(AST_Binary,e,{operator:n.operator,left:make_node(AST_UnaryPrefix,n.left,{operator:e.operator,expression:n.left}),right:n.right});if(t.option("evaluate")){if("~"===e.operator&&e.expression instanceof AST_UnaryPrefix&&"~"===e.expression.operator&&(t.in_32_bit_context(!1)||e.expression.expression.is_32_bit_integer(t)))return e.expression.expression;if("~"===e.operator&&n instanceof AST_Binary&&"^"===n.operator)return n.left instanceof AST_UnaryPrefix&&"~"===n.left.operator?n.left=n.left.bitwise_negate(t,!0):n.right=n.right.bitwise_negate(t,!0),n}if("-"!=e.operator||!(n instanceof AST_Number||n instanceof AST_Infinity||n instanceof AST_BigInt)){var i=e.evaluate(t);if(i!==e)return i=make_node_from_constant(i,e).optimize(t),best_of(t,i,e)}return e}),AST_Binary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")){if(this.left instanceof AST_Sequence){var t=this.left.expressions.slice();return(n=this.clone()).left=t.pop(),t.push(n),make_sequence(this,t).optimize(e)}if(this.right instanceof AST_Sequence&&!this.left.has_side_effects(e)){for(var n,o="="==this.operator&&this.left instanceof AST_SymbolRef,i=(t=this.right.expressions).length-1,r=0;r<i&&(o||!t[r].has_side_effects(e));r++);if(r==i)return t=t.slice(),(n=this.clone()).right=t.pop(),t.push(n),make_sequence(this,t).optimize(e);if(r>0)return(n=this.clone()).right=make_sequence(this.right,t.slice(r)),(t=t.slice(0,r)).push(n),make_sequence(this,t).optimize(e)}}return this});var commutativeOperators=makePredicate("== === != !== * & | ^");function is_object(e){return e instanceof AST_Array||e instanceof AST_Lambda||e instanceof AST_Object||e instanceof AST_Class}function is_atomic(e,t){return e instanceof AST_SymbolRef||e.TYPE===t.TYPE}def_optimize(AST_Binary,function(e,t){function n(){return e.left.is_constant()||e.right.is_constant()||!e.left.has_side_effects(t)&&!e.right.has_side_effects(t)}function o(t){if(n()){t&&(e.operator=t);var o=e.left;e.left=e.right,e.right=o}}if(t.option("lhs_constants")&&commutativeOperators.has(e.operator)&&e.right.is_constant()&&!e.left.is_constant()&&(e.left instanceof AST_Binary&&PRECEDENCE[e.left.operator]>=PRECEDENCE[e.operator]||o()),e=e.lift_sequences(t),t.option("comparisons"))switch(e.operator){case"===":case"!==":var i=!0;(e.left.is_string(t)&&e.right.is_string(t)||e.left.is_number(t)&&e.right.is_number(t)||e.left.is_bigint(t)&&e.right.is_bigint(t)||e.left.is_boolean()&&e.right.is_boolean()||e.left.equivalent_to(e.right))&&(e.operator=e.operator.substr(0,2));case"==":case"!=":if(!i&&is_undefined(e.left,t))e.left=make_node(AST_Null,e.left);else if(!i&&is_undefined(e.right,t))e.right=make_node(AST_Null,e.right);else if(t.option("typeofs")&&e.left instanceof AST_String&&"undefined"==e.left.value&&e.right instanceof AST_UnaryPrefix&&"typeof"==e.right.operator){((r=e.right.expression)instanceof AST_SymbolRef?!r.is_declared(t):r instanceof AST_PropAccess&&t.option("ie8"))||(e.right=r,e.left=make_node(AST_Undefined,e.left).optimize(t),2==e.operator.length&&(e.operator+="="))}else if(t.option("typeofs")&&e.left instanceof AST_UnaryPrefix&&"typeof"==e.left.operator&&e.right instanceof AST_String&&"undefined"==e.right.value){var r;((r=e.left.expression)instanceof AST_SymbolRef?!r.is_declared(t):r instanceof AST_PropAccess&&t.option("ie8"))||(e.left=r,e.right=make_node(AST_Undefined,e.right).optimize(t),2==e.operator.length&&(e.operator+="="))}else{if(e.left instanceof AST_SymbolRef&&e.right instanceof AST_SymbolRef&&e.left.definition()===e.right.definition()&&is_object(e.left.fixed_value()))return make_node("="==e.operator[0]?AST_True:AST_False,e);if(e.left.is_32_bit_integer(t)&&e.right.is_32_bit_integer(t)){const n=e=>make_node(AST_UnaryPrefix,e,{operator:"!",expression:e}),o=(e,o)=>o?t.in_boolean_context()?e:n(n(e)):n(e);if(e.left instanceof AST_Number&&0===e.left.value)return o(e.right,"!"===e.operator[0]);if(e.right instanceof AST_Number&&0===e.right.value)return o(e.left,"!"===e.operator[0]);let i,r,a;if((i=e.left instanceof AST_Binary?e.left:e.right instanceof AST_Binary?e.right:null)&&(a=i===e.left?e.right:e.left)&&"&"===i.operator&&a instanceof AST_Number&&a.is_32_bit_integer(t)&&(r=i.left.equivalent_to(a)?i.right:i.right.equivalent_to(a)?i.left:null)){let n=o(make_node(AST_Binary,e,{operator:"&",left:a,right:make_node(AST_UnaryPrefix,e,{operator:"~",expression:r})}),"!"===e.operator[0]);return best_of(t,n,e)}}}break;case"&&":case"||":var a=e.left;if(a.operator==e.operator&&(a=a.right),a instanceof AST_Binary&&a.operator==("&&"==e.operator?"!==":"===")&&e.right instanceof AST_Binary&&a.operator==e.right.operator&&(is_undefined(a.left,t)&&e.right.left instanceof AST_Null||a.left instanceof AST_Null&&is_undefined(e.right.left,t))&&!a.right.has_side_effects(t)&&a.right.equivalent_to(e.right.right)){var s=make_node(AST_Binary,e,{operator:a.operator.slice(0,-1),left:make_node(AST_Null,e),right:a.right});return a!==e.left&&(s=make_node(AST_Binary,e,{operator:e.operator,left:e.left.left,right:s})),s}}if("+"==e.operator&&t.in_boolean_context()){var _=e.left.evaluate(t),f=e.right.evaluate(t);if(_&&"string"==typeof _)return make_sequence(e,[e.right,make_node(AST_True,e)]).optimize(t);if(f&&"string"==typeof f)return make_sequence(e,[e.left,make_node(AST_True,e)]).optimize(t)}if(t.option("comparisons")&&e.is_boolean()){if(!(t.parent()instanceof AST_Binary)||t.parent()instanceof AST_Assign){var l=make_node(AST_UnaryPrefix,e,{operator:"!",expression:e.negate(t,first_in_statement(t))});e=best_of(t,e,l)}if(t.option("unsafe_comps"))switch(e.operator){case"<":o(">");break;case"<=":o(">=")}}if("+"==e.operator){if(e.right instanceof AST_String&&""==e.right.getValue()&&e.left.is_string(t))return e.left;if(e.left instanceof AST_String&&""==e.left.getValue()&&e.right.is_string(t))return e.right;if(e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.left instanceof AST_String&&""==e.left.left.getValue()&&e.right.is_string(t))return e.left=e.left.right,e}if(t.option("evaluate")){switch(e.operator){case"&&":if(!(_=!!has_flag(e.left,TRUTHY)||!has_flag(e.left,FALSY)&&e.left.evaluate(t)))return maintain_this_binding(t.parent(),t.self(),e.left).optimize(t);if(!(_ instanceof AST_Node))return make_sequence(e,[e.left,e.right]).optimize(t);if(f=e.right.evaluate(t)){if(!(f instanceof AST_Node)){if("&&"==(c=t.parent()).operator&&c.left===t.self()||t.in_boolean_context())return e.left.optimize(t)}}else{if(t.in_boolean_context())return make_sequence(e,[e.left,make_node(AST_False,e)]).optimize(t);set_flag(e,FALSY)}if("||"==e.left.operator)if(!(p=e.left.right.evaluate(t)))return make_node(AST_Conditional,e,{condition:e.left.left,consequent:e.right,alternative:e.left.right}).optimize(t);break;case"||":var c,p;if(!(_=!!has_flag(e.left,TRUTHY)||!has_flag(e.left,FALSY)&&e.left.evaluate(t)))return make_sequence(e,[e.left,e.right]).optimize(t);if(!(_ instanceof AST_Node))return maintain_this_binding(t.parent(),t.self(),e.left).optimize(t);if(f=e.right.evaluate(t)){if(!(f instanceof AST_Node)){if(t.in_boolean_context())return make_sequence(e,[e.left,make_node(AST_True,e)]).optimize(t);set_flag(e,TRUTHY)}}else if("||"==(c=t.parent()).operator&&c.left===t.self()||t.in_boolean_context())return e.left.optimize(t);if("&&"==e.left.operator)if((p=e.left.right.evaluate(t))&&!(p instanceof AST_Node))return make_node(AST_Conditional,e,{condition:e.left.left,consequent:e.left.right,alternative:e.right}).optimize(t);break;case"??":if(is_nullish(e.left,t))return e.right;if(!((_=e.left.evaluate(t))instanceof AST_Node))return null==_?e.right:e.left;if(t.in_boolean_context()){const n=e.right.evaluate(t);if(!(n instanceof AST_Node||n))return e.left}}var u=!0;switch(e.operator){case"+":if(e.right instanceof AST_Constant&&e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.is_string(t)){var d=(m=make_node(AST_Binary,e,{operator:"+",left:e.left.right,right:e.right})).optimize(t);m!==d&&(e=make_node(AST_Binary,e,{operator:"+",left:e.left.left,right:d}))}if(e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.is_string(t)&&e.right instanceof AST_Binary&&"+"==e.right.operator&&e.right.is_string(t)){var m,S=(m=make_node(AST_Binary,e,{operator:"+",left:e.left.right,right:e.right.left})).optimize(t);m!==S&&(e=make_node(AST_Binary,e,{operator:"+",left:make_node(AST_Binary,e.left,{operator:"+",left:e.left.left,right:S}),right:e.right.right}))}if(e.right instanceof AST_UnaryPrefix&&"-"==e.right.operator&&e.left.is_number_or_bigint(t)){e=make_node(AST_Binary,e,{operator:"-",left:e.left,right:e.right.expression});break}if(e.left instanceof AST_UnaryPrefix&&"-"==e.left.operator&&n()&&e.right.is_number_or_bigint(t)){e=make_node(AST_Binary,e,{operator:"-",left:e.right,right:e.left.expression});break}if(e.left instanceof AST_TemplateString){var T=e.left;if((d=e.right.evaluate(t))!=e.right)return T.segments[T.segments.length-1].value+=String(d),T}if(e.right instanceof AST_TemplateString){d=e.right;if((T=e.left.evaluate(t))!=e.left)return d.segments[0].value=String(T)+d.segments[0].value,d}if(e.left instanceof AST_TemplateString&&e.right instanceof AST_TemplateString){var A=(T=e.left).segments;d=e.right;A[A.length-1].value+=d.segments[0].value;for(var g=1;g<d.segments.length;g++)A.push(d.segments[g]);return T}case"*":u=t.option("unsafe_math");case"&":case"|":case"^":if(e.left.is_number_or_bigint(t)&&e.right.is_number_or_bigint(t)&&n()&&!(e.left instanceof AST_Binary&&e.left.operator!=e.operator&&PRECEDENCE[e.left.operator]>=PRECEDENCE[e.operator])){var h=make_node(AST_Binary,e,{operator:e.operator,left:e.right,right:e.left});e=e.right instanceof AST_Constant&&!(e.left instanceof AST_Constant)?best_of(t,h,e):best_of(t,e,h)}u&&e.is_number_or_bigint(t)&&(e.right instanceof AST_Binary&&e.right.operator==e.operator&&(e=make_node(AST_Binary,e,{operator:e.operator,left:make_node(AST_Binary,e.left,{operator:e.operator,left:e.left,right:e.right.left,start:e.left.start,end:e.right.left.end}),right:e.right.right})),e.right instanceof AST_Constant&&e.left instanceof AST_Binary&&e.left.operator==e.operator&&(e.left.left instanceof AST_Constant?e=make_node(AST_Binary,e,{operator:e.operator,left:make_node(AST_Binary,e.left,{operator:e.operator,left:e.left.left,right:e.right,start:e.left.left.start,end:e.right.end}),right:e.left.right}):e.left.right instanceof AST_Constant&&(e=make_node(AST_Binary,e,{operator:e.operator,left:make_node(AST_Binary,e.left,{operator:e.operator,left:e.left.right,right:e.right,start:e.left.right.start,end:e.right.end}),right:e.left.left}))),e.left instanceof AST_Binary&&e.left.operator==e.operator&&e.left.right instanceof AST_Constant&&e.right instanceof AST_Binary&&e.right.operator==e.operator&&e.right.left instanceof AST_Constant&&(e=make_node(AST_Binary,e,{operator:e.operator,left:make_node(AST_Binary,e.left,{operator:e.operator,left:make_node(AST_Binary,e.left.left,{operator:e.operator,left:e.left.right,right:e.right.left,start:e.left.right.start,end:e.right.left.end}),right:e.left.left}),right:e.right.right})))}if(bitwise_binop.has(e.operator)){let n,o,i,r,a=e.left;if("&"===e.operator&&e.right instanceof AST_Binary&&"|"===e.right.operator&&"number"==typeof(o=e.left.evaluate(t))&&("number"==typeof(n=e.right.right.evaluate(t))?(i=e.right.left,r=e.right.right):"number"==typeof(n=e.right.left.evaluate(t))&&(i=e.right.right,r=e.right.left),i&&r))if(0===(n&o))e=make_node(AST_Binary,e,{operator:e.operator,left:a,right:i});else{const s=make_node(AST_Binary,e,{operator:"|",left:make_node(AST_Binary,e,{operator:"&",left:i,right:a}),right:make_node_from_constant(n&o,r)});e=best_of(t,e,s)}"|"!==e.operator&&"&"!==e.operator||!e.left.equivalent_to(e.right)||e.left.has_side_effects(t)||!t.in_32_bit_context(!0)||(e.left=make_node(AST_Number,e,{value:0}),e.operator="|"),"^"===e.operator&&e.left instanceof AST_UnaryPrefix&&"~"===e.left.operator&&e.right instanceof AST_UnaryPrefix&&"~"===e.right.operator&&(e=make_node(AST_Binary,e,{operator:"^",left:e.left.expression,right:e.right.expression})),("<<"===e.operator||">>"===e.operator)&&e.right instanceof AST_Number&&0===e.right.value&&(e.operator="|");const s=e.right instanceof AST_Number&&0===e.right.value?e.right:e.left instanceof AST_Number&&0===e.left.value?e.left:null,_=s&&(s===e.right?e.left:e.right);if(s&&("|"===e.operator||"^"===e.operator)&&(_.is_32_bit_integer(t)||t.in_32_bit_context(!0)))return _;if(s&&"&"===e.operator&&!_.has_side_effects(t)&&_.is_32_bit_integer(t))return s;const f=e=>e instanceof AST_Number&&-1===e.value||e instanceof AST_UnaryPrefix&&"-"===e.operator&&e.expression instanceof AST_Number&&1===e.expression.value,l=f(e.right)?e.right:f(e.left)?e.left:null,c=l===e.right?e.left:e.right;if(l&&"&"===e.operator&&(c.is_32_bit_integer(t)||t.in_32_bit_context(!0)))return c;if(l&&"^"===e.operator&&(c.is_32_bit_integer(t)||t.in_32_bit_context(!0)))return c.bitwise_negate(t)}}if(e.right instanceof AST_Binary&&e.right.operator==e.operator&&(lazy_op.has(e.operator)||"+"==e.operator&&(e.right.left.is_string(t)||e.left.is_string(t)&&e.right.right.is_string(t))))return e.left=make_node(AST_Binary,e.left,{operator:e.operator,left:e.left.transform(t),right:e.right.left.transform(t)}),e.right=e.right.right.transform(t),e.transform(t);var y=e.evaluate(t);return y!==e?(y=make_node_from_constant(y,e).optimize(t),best_of(t,y,e)):e}),def_optimize(AST_SymbolExport,function(e){return e}),def_optimize(AST_SymbolRef,function(e,t){if(!t.option("ie8")&&is_undeclared_ref(e)&&!t.find_parent(AST_With))switch(e.name){case"undefined":return make_node(AST_Undefined,e).optimize(t);case"NaN":return make_node(AST_NaN,e).optimize(t);case"Infinity":return make_node(AST_Infinity,e).optimize(t)}return t.option("reduce_vars")&&!t.is_lhs()?inline_into_symbolref(e,t):e}),def_optimize(AST_Undefined,function(e,t){if(t.option("unsafe_undefined")){var n=find_variable(t,"undefined");if(n){var o=make_node(AST_SymbolRef,e,{name:"undefined",scope:n.scope,thedef:n});return set_flag(o,UNDEFINED),o}}var i=t.is_lhs();return i&&is_atomic(i,e)?e:make_node(AST_UnaryPrefix,e,{operator:"void",expression:make_node(AST_Number,e,{value:0})})}),def_optimize(AST_Infinity,function(e,t){var n=t.is_lhs();return n&&is_atomic(n,e)?e:!t.option("keep_infinity")||n&&!is_atomic(n,e)||find_variable(t,"Infinity")?make_node(AST_Binary,e,{operator:"/",left:make_node(AST_Number,e,{value:1}),right:make_node(AST_Number,e,{value:0})}):e}),def_optimize(AST_NaN,function(e,t){var n=t.is_lhs();return n&&!is_atomic(n,e)||find_variable(t,"NaN")?make_node(AST_Binary,e,{operator:"/",left:make_node(AST_Number,e,{value:0}),right:make_node(AST_Number,e,{value:0})}):e});const ASSIGN_OPS=makePredicate("+ - / * % >> << >>> | ^ &"),ASSIGN_OPS_COMMUTATIVE=makePredicate("* | ^ &");function is_nullish_check(e,t,n){if(t.may_throw(n))return!1;let o;if(e instanceof AST_Binary&&"=="===e.operator&&((o=is_nullish(e.left,n)&&e.left)||(o=is_nullish(e.right,n)&&e.right))&&(o===e.left?e.right:e.left).equivalent_to(t))return!0;if(e instanceof AST_Binary&&"||"===e.operator){let o,i;const r=e=>{if(!(e instanceof AST_Binary)||"==="!==e.operator&&"=="!==e.operator)return!1;let r,a=0;return e.left instanceof AST_Null&&(a++,o=e,r=e.right),e.right instanceof AST_Null&&(a++,o=e,r=e.left),is_undefined(e.left,n)&&(a++,i=e,r=e.right),is_undefined(e.right,n)&&(a++,i=e,r=e.left),1===a&&!!r.equivalent_to(t)};if(!r(e.left))return!1;if(!r(e.right))return!1;if(o&&i&&o!==i)return!0}return!1}function safe_to_flatten(e,t){return e instanceof AST_SymbolRef&&(e=e.fixed_value()),!!e&&(!(e instanceof AST_Lambda||e instanceof AST_Class)||(!(e instanceof AST_Lambda&&e.contains_this())||t.parent()instanceof AST_New))}function literals_in_boolean_context(e,t){return t.in_boolean_context()?best_of(t,e,make_sequence(e,[e,make_node(AST_True,e)]).optimize(t)):e}function inline_array_like_spread(e){for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof AST_Expansion){var o=n.expression;o instanceof AST_Array&&!o.elements.some(e=>e instanceof AST_Hole)&&(e.splice(t,1,...o.elements),t--)}}}function inline_object_prop_spread(e){for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof AST_Expansion){const o=n.expression;o instanceof AST_Object&&o.properties.every(e=>e instanceof AST_ObjectKeyVal)?(e.splice(t,1,...o.properties),t--):!(o instanceof AST_Constant||o.is_constant())||o instanceof AST_String||(e.splice(t,1),t--)}}}function lift_key(e,t){if(!t.option("computed_props"))return e;if(!(e.key instanceof AST_Constant))return e;if(e.key instanceof AST_String||e.key instanceof AST_Number){const n=e.key.value.toString();if("__proto__"===n)return e;if("constructor"==n&&t.parent()instanceof AST_Class)return e;e instanceof AST_ObjectKeyVal?(e.quote=e.key.quote,e.key=n):e instanceof AST_ClassProperty?(e.quote=e.key.quote,e.key=make_node(AST_SymbolClassProperty,e.key,{name:n})):(e.quote=e.key.quote,e.key=make_node(AST_SymbolMethod,e.key,{name:n}))}return e}def_optimize(AST_Assign,function(e,t){if(e.logical)return e.lift_sequences(t);var n;if("="===e.operator&&e.left instanceof AST_SymbolRef&&"arguments"!==e.left.name&&!(n=e.left.definition()).undeclared&&e.right.equivalent_to(e.left))return e.right;if(t.option("dead_code")&&e.left instanceof AST_SymbolRef&&(n=e.left.definition()).scope===t.find_parent(AST_Lambda)){var o,i=0,r=e;do{if(o=r,(r=t.parent(i++))instanceof AST_Exit){if(a(i,r))break;if(is_reachable(n.scope,[n]))break;return"="==e.operator?e.right:(n.fixed=!1,make_node(AST_Binary,e,{operator:e.operator.slice(0,-1),left:e.left,right:e.right}).optimize(t))}}while(r instanceof AST_Binary&&r.right===o||r instanceof AST_Sequence&&r.tail_node()===o)}return"="==(e=e.lift_sequences(t)).operator&&e.left instanceof AST_SymbolRef&&e.right instanceof AST_Binary&&(e.right.left instanceof AST_SymbolRef&&e.right.left.name==e.left.name&&ASSIGN_OPS.has(e.right.operator)?(e.operator=e.right.operator+"=",e.right=e.right.right):e.right.right instanceof AST_SymbolRef&&e.right.right.name==e.left.name&&ASSIGN_OPS_COMMUTATIVE.has(e.right.operator)&&!e.right.left.has_side_effects(t)&&(e.operator=e.right.operator+"=",e.right=e.right.left)),e;function a(n,o){function i(){const n=e.right;e.right=make_node(AST_Null,n);const i=o.may_throw(t);return e.right=n,i}for(var r,a=e.left.definition().scope.get_defun_scope();(r=t.parent(n++))!==a;)if(r instanceof AST_Try){if(r.bfinally)return!0;if(r.bcatch&&i())return!0}}}),def_optimize(AST_DefaultAssign,function(e,t){if(!t.option("evaluate"))return e;var n=e.right.evaluate(t);let o,i;return void 0===n?(o=t.parent())instanceof AST_Lambda&&!1!==t.option("keep_fargs")&&("Call"!==(i=t.parent(1)).TYPE||i.expression!==o)||(e=e.left):n!==e.right&&(n=make_node_from_constant(n,e.right),e.right=best_of_expression(n,e.right)),e}),def_optimize(AST_Conditional,function(e,t){if(!t.option("conditionals"))return e;if(e.condition instanceof AST_Sequence){var n=e.condition.expressions.slice();return e.condition=n.pop(),n.push(e),make_sequence(e,n)}var o=e.condition.evaluate(t);if(o!==e.condition)return maintain_this_binding(t.parent(),t.self(),o?e.consequent:e.alternative);var i=o.negate(t,first_in_statement(t));best_of(t,o,i)===i&&(e=make_node(AST_Conditional,e,{condition:i,consequent:e.alternative,alternative:e.consequent}));var r,a=e.condition,s=e.consequent,_=e.alternative;if(a instanceof AST_SymbolRef&&s instanceof AST_SymbolRef&&a.definition()===s.definition())return make_node(AST_Binary,e,{operator:"||",left:a,right:_});if(s instanceof AST_Assign&&_ instanceof AST_Assign&&s.operator===_.operator&&s.logical===_.logical&&s.left.equivalent_to(_.left)&&(!e.condition.has_side_effects(t)||"="==s.operator&&!s.left.has_side_effects(t)))return make_node(AST_Assign,e,{operator:s.operator,left:s.left,logical:s.logical,right:make_node(AST_Conditional,e,{condition:e.condition,consequent:s.right,alternative:_.right})});if(s instanceof AST_Call&&_.TYPE===s.TYPE&&s.args.length>0&&s.args.length==_.args.length&&s.expression.equivalent_to(_.expression)&&!e.condition.has_side_effects(t)&&!s.expression.has_side_effects(t)&&"number"==typeof(r=function(){for(var e=s.args,t=_.args,n=0,o=e.length;n<o;n++){if(e[n]instanceof AST_Expansion)return;if(!e[n].equivalent_to(t[n])){if(t[n]instanceof AST_Expansion)return;for(var i=n+1;i<o;i++){if(e[i]instanceof AST_Expansion)return;if(!e[i].equivalent_to(t[i]))return}return n}}}())){var f=s.clone();return f.args[r]=make_node(AST_Conditional,e,{condition:e.condition,consequent:s.args[r],alternative:_.args[r]}),f}if(_ instanceof AST_Conditional&&s.equivalent_to(_.consequent))return make_node(AST_Conditional,e,{condition:make_node(AST_Binary,e,{operator:"||",left:a,right:_.condition}),consequent:s,alternative:_.alternative}).optimize(t);if(t.option("ecma")>=2020&&is_nullish_check(a,_,t))return make_node(AST_Binary,e,{operator:"??",left:_,right:s}).optimize(t);if(_ instanceof AST_Sequence&&s.equivalent_to(_.expressions[_.expressions.length-1]))return make_sequence(e,[make_node(AST_Binary,e,{operator:"||",left:a,right:make_sequence(e,_.expressions.slice(0,-1))}),s]).optimize(t);if(_ instanceof AST_Binary&&"&&"==_.operator&&s.equivalent_to(_.right))return make_node(AST_Binary,e,{operator:"&&",left:make_node(AST_Binary,e,{operator:"||",left:a,right:_.left}),right:s}).optimize(t);if(s instanceof AST_Conditional&&s.alternative.equivalent_to(_))return make_node(AST_Conditional,e,{condition:make_node(AST_Binary,e,{left:e.condition,operator:"&&",right:s.condition}),consequent:s.consequent,alternative:_});if(s.equivalent_to(_))return make_sequence(e,[e.condition,s]).optimize(t);if(s instanceof AST_Binary&&"||"==s.operator&&s.right.equivalent_to(_))return make_node(AST_Binary,e,{operator:"||",left:make_node(AST_Binary,e,{operator:"&&",left:e.condition,right:s.left}),right:_}).optimize(t);const l=t.in_boolean_context();return p(e.consequent)?u(e.alternative)?c(e.condition):make_node(AST_Binary,e,{operator:"||",left:c(e.condition),right:e.alternative}):u(e.consequent)?p(e.alternative)?c(e.condition.negate(t)):make_node(AST_Binary,e,{operator:"&&",left:c(e.condition.negate(t)),right:e.alternative}):p(e.alternative)?make_node(AST_Binary,e,{operator:"||",left:c(e.condition.negate(t)),right:e.consequent}):u(e.alternative)?make_node(AST_Binary,e,{operator:"&&",left:c(e.condition),right:e.consequent}):e;function c(e){return e.is_boolean()?e:make_node(AST_UnaryPrefix,e,{operator:"!",expression:e.negate(t)})}function p(e){return e instanceof AST_True||l&&e instanceof AST_Constant&&e.getValue()||e instanceof AST_UnaryPrefix&&"!"==e.operator&&e.expression instanceof AST_Constant&&!e.expression.getValue()}function u(e){return e instanceof AST_False||l&&e instanceof AST_Constant&&!e.getValue()||e instanceof AST_UnaryPrefix&&"!"==e.operator&&e.expression instanceof AST_Constant&&e.expression.getValue()}}),def_optimize(AST_Boolean,function(e,t){if(t.in_boolean_context())return make_node(AST_Number,e,{value:+e.value});var n=t.parent();return t.option("booleans_as_integers")?(n instanceof AST_Binary&&("==="==n.operator||"!=="==n.operator)&&(n.operator=n.operator.replace(/=$/,"")),make_node(AST_Number,e,{value:+e.value})):t.option("booleans")?n instanceof AST_Binary&&("=="==n.operator||"!="==n.operator)?make_node(AST_Number,e,{value:+e.value}):make_node(AST_UnaryPrefix,e,{operator:"!",expression:make_node(AST_Number,e,{value:1-e.value})}):e}),AST_PropAccess.DEFMETHOD("flatten_object",function(e,t){if(t.option("properties")&&"__proto__"!==e&&!(this instanceof AST_DotHash)){var n=t.option("unsafe_arrows")&&t.option("ecma")>=2015,o=this.expression;if(o instanceof AST_Object)for(var i=o.properties,r=i.length;--r>=0;){var a=i[r];if(""+(a instanceof AST_ConciseMethod?a.key.name:a.key)==e){if(!i.every(e=>(e instanceof AST_ObjectKeyVal||n&&e instanceof AST_ConciseMethod&&!e.value.is_generator)&&!e.computed_key()))return;if(!safe_to_flatten(a.value,t))return;return make_node(AST_Sub,this,{expression:make_node(AST_Array,o,{elements:i.map(function(e){var t=e.value;t instanceof AST_Accessor&&(t=make_node(AST_Function,t,t));var n=e.key;return n instanceof AST_Node&&!(n instanceof AST_SymbolMethod)?make_sequence(e,[n,t]):t})}),property:make_node(AST_Number,this,{value:r})})}}}}),def_optimize(AST_Sub,function(e,t){var n,o=e.expression,i=e.property;if(t.option("properties")){var r=i.evaluate(t);if(r!==i){if("string"==typeof r)if("undefined"==r)r=void 0;else(y=parseFloat(r)).toString()==r&&(r=y);i=e.property=best_of_expression(i,make_node_from_constant(r,i).transform(t));var a=""+r;if(is_basic_identifier_string(a)&&a.length<=i.size()+1)return make_node(AST_Dot,e,{expression:o,optional:e.optional,property:a,quote:i.quote}).optimize(t)}}e:if(t.option("arguments")&&o instanceof AST_SymbolRef&&"arguments"==o.name&&1==o.definition().orig.length&&(n=o.scope)instanceof AST_Lambda&&n.uses_arguments&&!(n instanceof AST_Arrow)&&i instanceof AST_Number){for(var s=i.getValue(),_=new Set,f=n.argnames,l=0;l<f.length;l++){if(!(f[l]instanceof AST_SymbolFunarg))break e;var c=f[l].name;if(_.has(c))break e;_.add(c)}var p=n.argnames[s];if(p&&t.has_directive("use strict")){var u=p.definition();(!t.option("reduce_vars")||u.assignments||u.orig.length>1)&&(p=null)}else if(!p&&!t.option("keep_fargs")&&s<n.argnames.length+5)for(;s>=n.argnames.length;)p=n.create_symbol(AST_SymbolFunarg,{source:n,scope:n,tentative_name:"argument_"+n.argnames.length}),n.argnames.push(p);if(p){var d=make_node(AST_SymbolRef,e,p);return d.reference({}),clear_flag(p,UNUSED),d}}if(t.is_lhs())return e;if(r!==i){var m=e.flatten_object(a,t);m&&(o=e.expression=m.expression,i=e.property=m.property)}if(t.option("properties")&&t.option("side_effects")&&i instanceof AST_Number&&o instanceof AST_Array){s=i.getValue();var S=o.elements,T=S[s];e:if(safe_to_flatten(T,t)){for(var A=!0,g=[],h=S.length;--h>s;){(y=S[h].drop_side_effect_free(t))&&(g.unshift(y),A&&y.has_side_effects(t)&&(A=!1))}if(T instanceof AST_Expansion)break e;for(T=T instanceof AST_Hole?make_node(AST_Undefined,T):T,A||g.unshift(T);--h>=0;){var y;if((y=S[h])instanceof AST_Expansion)break e;(y=y.drop_side_effect_free(t))?g.unshift(y):s--}return A?(g.push(T),make_sequence(e,g).optimize(t)):make_node(AST_Sub,e,{expression:make_node(AST_Array,o,{elements:g}),property:make_node(AST_Number,i,{value:s})})}}var b=e.evaluate(t);return b!==e?(b=make_node_from_constant(b,e).optimize(t),best_of(t,b,e)):e}),def_optimize(AST_Chain,function(e,t){if(is_nullish(e.expression,t)){let n=t.parent();return n instanceof AST_UnaryPrefix&&"delete"===n.operator?make_node_from_constant(0,e):make_node(AST_Undefined,e)}return e.expression instanceof AST_PropAccess||e.expression instanceof AST_Call?e:e.expression}),def_optimize(AST_Dot,function(e,t){const n=t.parent();if(t.is_lhs())return e;if(t.option("unsafe_proto")&&e.expression instanceof AST_Dot&&"prototype"==e.expression.property){var o=e.expression.expression;if(is_undeclared_ref(o))switch(o.name){case"Array":e.expression=make_node(AST_Array,e.expression,{elements:[]});break;case"Function":e.expression=make_empty_function(e.expression);break;case"Number":e.expression=make_node(AST_Number,e.expression,{value:0});break;case"Object":e.expression=make_node(AST_Object,e.expression,{properties:[]});break;case"RegExp":e.expression=make_node(AST_RegExp,e.expression,{value:{source:"t",flags:""}});break;case"String":e.expression=make_node(AST_String,e.expression,{value:""})}}if(!(n instanceof AST_Call&&has_annotation(n,_NOINLINE))){const n=e.flatten_object(e.property,t);if(n)return n.optimize(t)}if(e.expression instanceof AST_PropAccess&&n instanceof AST_PropAccess)return e;let i=e.evaluate(t);return i!==e?(i=make_node_from_constant(i,e).optimize(t),best_of(t,i,e)):e}),def_optimize(AST_Array,function(e,t){var n=literals_in_boolean_context(e,t);return n!==e?n:(inline_array_like_spread(e.elements),e)}),def_optimize(AST_Object,function(e,t){var n=literals_in_boolean_context(e,t);return n!==e?n:(inline_object_prop_spread(e.properties),e)}),def_optimize(AST_RegExp,literals_in_boolean_context),def_optimize(AST_Return,function(e,t){return e.value&&is_undefined(e.value,t)&&(e.value=null),e}),def_optimize(AST_Arrow,opt_AST_Lambda),def_optimize(AST_Function,function(e,t){if(e=opt_AST_Lambda(e,t),t.option("unsafe_arrows")&&t.option("ecma")>=2015&&!e.name&&!e.is_generator&&!e.uses_arguments&&!e.pinned()){if(!walk(e,e=>{if(e instanceof AST_This)return walk_abort}))return make_node(AST_Arrow,e,e).optimize(t)}return e}),def_optimize(AST_Class,function(e){for(let t=0;t<e.properties.length;t++){const n=e.properties[t];n instanceof AST_ClassStaticBlock&&0==n.body.length&&(e.properties.splice(t,1),t--)}return e}),def_optimize(AST_ClassStaticBlock,function(e,t){return tighten_body(e.body,t),e}),def_optimize(AST_Yield,function(e,t){return e.expression&&!e.is_star&&is_undefined(e.expression,t)&&(e.expression=null),e}),def_optimize(AST_TemplateString,function(e,t){if(!t.option("evaluate")||t.parent()instanceof AST_PrefixedTemplateString)return e;for(var n=[],o=0;o<e.segments.length;o++){var i=e.segments[o];if(i instanceof AST_Node){var r=i.evaluate(t);if(r!==i&&(r+"").length<=i.size()+3){n[n.length-1].value=n[n.length-1].value+r+e.segments[++o].value;continue}if(i instanceof AST_TemplateString){var a=i.segments;n[n.length-1].value+=a[0].value;for(var s=1;s<a.length;s++)i=a[s],n.push(i);continue}}n.push(i)}if(e.segments=n,1==n.length)return make_node(AST_String,e,n[0]);if(3===n.length&&n[1]instanceof AST_Node&&(n[1].is_string(t)||n[1].is_number_or_bigint(t)||is_nullish(n[1],t)||t.option("unsafe"))){if(""===n[2].value)return make_node(AST_Binary,e,{operator:"+",left:make_node(AST_String,e,{value:n[0].value}),right:n[1]});if(""===n[0].value)return make_node(AST_Binary,e,{operator:"+",left:n[1],right:make_node(AST_String,e,{value:n[2].value})})}return e}),def_optimize(AST_PrefixedTemplateString,function(e){return e}),def_optimize(AST_ObjectProperty,lift_key),def_optimize(AST_ConciseMethod,function(e,t){if(lift_key(e,t),t.option("arrows")&&t.parent()instanceof AST_Object&&!e.value.is_generator&&!e.value.uses_arguments&&!e.value.pinned()&&1==e.value.body.length&&e.value.body[0]instanceof AST_Return&&e.value.body[0].value&&!e.value.contains_this()){var n=make_node(AST_Arrow,e.value,e.value);return n.async=e.value.async,n.is_generator=e.value.is_generator,make_node(AST_ObjectKeyVal,e,{key:e.key instanceof AST_SymbolMethod?e.key.name:e.key,value:n,quote:e.quote})}return e}),def_optimize(AST_ObjectKeyVal,function(e,t){lift_key(e,t);var n=t.option("unsafe_methods");if(n&&t.option("ecma")>=2015&&(!(n instanceof RegExp)||n.test(e.key+""))){var o=e.key,i=e.value;if((i instanceof AST_Arrow&&Array.isArray(i.body)&&!i.contains_this()||i instanceof AST_Function)&&!i.name)return make_node(AST_ConciseMethod,e,{key:o instanceof AST_Node?o:make_node(AST_SymbolMethod,e,{name:o}),value:make_node(AST_Accessor,i,i),quote:e.quote})}return e}),def_optimize(AST_Destructuring,function(e,t){if(1==t.option("pure_getters")&&t.option("unused")&&!e.is_array&&Array.isArray(e.names)&&!function(e){for(var t=[/^VarDef$/,/^(Const|Let|Var)$/,/^Export$/],n=0,o=0,i=t.length;n<i;o++){var r=e.parent(o);if(!r)return!1;if(0!==n||"Destructuring"!=r.TYPE){if(!t[n].test(r.TYPE))return!1;n++}}return!0}(t)&&!(e.names[e.names.length-1]instanceof AST_Expansion)){for(var n=[],o=0;o<e.names.length;o++){var i=e.names[o];i instanceof AST_ObjectKeyVal&&"string"==typeof i.key&&i.value instanceof AST_SymbolDeclaration&&!r(t,i.value.definition())||n.push(i)}n.length!=e.names.length&&(e.names=n)}return e;function r(e,t){return!!t.references.length||!!t.global&&(!e.toplevel.vars||!!e.top_retain&&e.top_retain(t))}});export{Compressor};