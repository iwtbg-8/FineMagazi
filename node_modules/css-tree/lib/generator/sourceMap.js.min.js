import{SourceMapGenerator}from"source-map-js/lib/source-map-generator.js";const trackNodes=new Set(["Atrule","Selector","Declaration"]);export function generateSourceMap(e){const n=new SourceMapGenerator,o={line:1,column:0},t={line:0,column:0},c={line:1,column:0},l={generated:c};let r=1,a=0,i=!1;const u=e.node;e.node=function(e){if(e.loc&&e.loc.start&&trackNodes.has(e.type)){const u=e.loc.start.line,s=e.loc.start.column-1;t.line===u&&t.column===s||(t.line=u,t.column=s,o.line=r,o.column=a,i&&(i=!1,o.line===c.line&&o.column===c.column||n.addMapping(l)),i=!0,n.addMapping({source:e.loc.source,original:t,generated:o}))}u.call(this,e),i&&trackNodes.has(e.type)&&(c.line=r,c.column=a)};const s=e.emit;e.emit=function(e,n,o){for(let n=0;n<e.length;n++)10===e.charCodeAt(n)?(r++,a=0):a++;s(e,n,o)};const m=e.result;return e.result=function(){return i&&n.addMapping(l),{css:m(),map:n}},e}