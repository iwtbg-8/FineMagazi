import*as TYPE from"./types.js";import{isNewline,isName,isValidEscape,isNumberStart,isIdentifierStart,isBOM,charCodeCategory,WhiteSpaceCategory,DigitCategory,NameStartCategory,NonPrintableCategory}from"./char-code-definitions.js";import{cmpStr,getNewlineLength,findWhiteSpaceEnd,consumeEscaped,consumeName,consumeNumber,consumeBadUrlRemnants}from"./utils.js";export function tokenize(e,a){function t(a){return a<n?e.charCodeAt(a):0}function r(){return m=consumeNumber(e,m),isIdentifierStart(t(m),t(m+1),t(m+2))?(o=TYPE.Dimension,void(m=consumeName(e,m))):37===t(m)?(o=TYPE.Percentage,void m++):void(o=TYPE.Number)}function i(){const a=m;return m=consumeName(e,m),cmpStr(e,a,m,"url")&&40===t(m)?(m=findWhiteSpaceEnd(e,m+1),34===t(m)||39===t(m)?(o=TYPE.Function,void(m=a+4)):void function(){for(o=TYPE.Url,m=findWhiteSpaceEnd(e,m);m<e.length;m++){const a=e.charCodeAt(m);switch(charCodeCategory(a)){case 41:return void m++;case WhiteSpaceCategory:return m=findWhiteSpaceEnd(e,m),41===t(m)||m>=e.length?void(m<e.length&&m++):(m=consumeBadUrlRemnants(e,m),void(o=TYPE.BadUrl));case 34:case 39:case 40:case NonPrintableCategory:return m=consumeBadUrlRemnants(e,m),void(o=TYPE.BadUrl);case 92:if(isValidEscape(a,t(m+1))){m=consumeEscaped(e,m)-1;break}return m=consumeBadUrlRemnants(e,m),void(o=TYPE.BadUrl)}}}()):40===t(m)?(o=TYPE.Function,void m++):void(o=TYPE.Ident)}function s(a){for(a||(a=t(m++)),o=TYPE.String;m<e.length;m++){const r=e.charCodeAt(m);switch(charCodeCategory(r)){case a:return void m++;case WhiteSpaceCategory:if(isNewline(r))return m+=getNewlineLength(e,m,r),void(o=TYPE.BadString);break;case 92:if(m===e.length-1)break;const i=t(m+1);isNewline(i)?m+=getNewlineLength(e,m+1,i):isValidEscape(r,i)&&(m=consumeEscaped(e,m)-1)}}}const n=(e=String(e||"")).length;let o,c=isBOM(t(0)),m=c;for(;m<n;){const n=e.charCodeAt(m);switch(charCodeCategory(n)){case WhiteSpaceCategory:o=TYPE.WhiteSpace,m=findWhiteSpaceEnd(e,m+1);break;case 34:s();break;case 35:isName(t(m+1))||isValidEscape(t(m+1),t(m+2))?(o=TYPE.Hash,m=consumeName(e,m+1)):(o=TYPE.Delim,m++);break;case 39:s();break;case 40:o=TYPE.LeftParenthesis,m++;break;case 41:o=TYPE.RightParenthesis,m++;break;case 43:isNumberStart(n,t(m+1),t(m+2))?r():(o=TYPE.Delim,m++);break;case 44:o=TYPE.Comma,m++;break;case 45:isNumberStart(n,t(m+1),t(m+2))?r():45===t(m+1)&&62===t(m+2)?(o=TYPE.CDC,m+=3):isIdentifierStart(n,t(m+1),t(m+2))?i():(o=TYPE.Delim,m++);break;case 46:isNumberStart(n,t(m+1),t(m+2))?r():(o=TYPE.Delim,m++);break;case 47:42===t(m+1)?(o=TYPE.Comment,m=e.indexOf("*/",m+2),m=-1===m?e.length:m+2):(o=TYPE.Delim,m++);break;case 58:o=TYPE.Colon,m++;break;case 59:o=TYPE.Semicolon,m++;break;case 60:33===t(m+1)&&45===t(m+2)&&45===t(m+3)?(o=TYPE.CDO,m+=4):(o=TYPE.Delim,m++);break;case 64:isIdentifierStart(t(m+1),t(m+2),t(m+3))?(o=TYPE.AtKeyword,m=consumeName(e,m+1)):(o=TYPE.Delim,m++);break;case 91:o=TYPE.LeftSquareBracket,m++;break;case 92:isValidEscape(n,t(m+1))?i():(o=TYPE.Delim,m++);break;case 93:o=TYPE.RightSquareBracket,m++;break;case 123:o=TYPE.LeftCurlyBracket,m++;break;case 125:o=TYPE.RightCurlyBracket,m++;break;case DigitCategory:r();break;case NameStartCategory:i();break;default:o=TYPE.Delim,m++}a(o,c,c=m)}}export*from"./types.js";export*as tokenTypes from"./types.js";export{default as tokenNames}from"./names.js";export*from"./char-code-definitions.js";export*from"./utils.js";export*from"./OffsetToLocation.js";export*from"./TokenStream.js";