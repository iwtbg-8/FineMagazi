import{isDigit,isHexDigit,isUppercaseLetter,isName,isWhiteSpace,isValidEscape}from"./char-code-definitions.js";function getCharCode(e,t){return t<e.length?e.charCodeAt(t):0}export function getNewlineLength(e,t,r){return 13===r&&10===getCharCode(e,t+1)?2:1}export function cmpChar(e,t,r){let i=e.charCodeAt(t);return isUppercaseLetter(i)&&(i|=32),i===r}export function cmpStr(e,t,r,i){if(r-t!==i.length)return!1;if(t<0||r>e.length)return!1;for(let n=t;n<r;n++){const r=i.charCodeAt(n-t);let o=e.charCodeAt(n);if(isUppercaseLetter(o)&&(o|=32),o!==r)return!1}return!0}export function findWhiteSpaceStart(e,t){for(;t>=0&&isWhiteSpace(e.charCodeAt(t));t--);return t+1}export function findWhiteSpaceEnd(e,t){for(;t<e.length&&isWhiteSpace(e.charCodeAt(t));t++);return t}export function findDecimalNumberEnd(e,t){for(;t<e.length&&isDigit(e.charCodeAt(t));t++);return t}export function consumeEscaped(e,t){if(isHexDigit(getCharCode(e,(t+=2)-1))){for(const r=Math.min(e.length,t+5);t<r&&isHexDigit(getCharCode(e,t));t++);const r=getCharCode(e,t);isWhiteSpace(r)&&(t+=getNewlineLength(e,t,r))}return t}export function consumeName(e,t){for(;t<e.length;t++){const r=e.charCodeAt(t);if(!isName(r)){if(!isValidEscape(r,getCharCode(e,t+1)))break;t=consumeEscaped(e,t)-1}}return t}export function consumeNumber(e,t){let r=e.charCodeAt(t);if(43!==r&&45!==r||(r=e.charCodeAt(t+=1)),isDigit(r)&&(t=findDecimalNumberEnd(e,t+1),r=e.charCodeAt(t)),46===r&&isDigit(e.charCodeAt(t+1))&&(t=findDecimalNumberEnd(e,t+=2)),cmpChar(e,t,101)){let i=0;r=e.charCodeAt(t+1),45!==r&&43!==r||(i=1,r=e.charCodeAt(t+2)),isDigit(r)&&(t=findDecimalNumberEnd(e,t+1+i+1))}return t}export function consumeBadUrlRemnants(e,t){for(;t<e.length;t++){const r=e.charCodeAt(t);if(41===r){t++;break}isValidEscape(r,getCharCode(e,t+1))&&(t=consumeEscaped(e,t))}return t}export function decodeEscaped(e){if(1===e.length&&!isHexDigit(e.charCodeAt(0)))return e[0];let t=parseInt(e,16);return(0===t||t>=55296&&t<=57343||t>1114111)&&(t=65533),String.fromCodePoint(t)}