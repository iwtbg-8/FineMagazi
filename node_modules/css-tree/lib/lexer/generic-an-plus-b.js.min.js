import{isDigit,cmpChar,Delim,WhiteSpace,Comment,Ident,Number as NumberToken,Dimension}from"../tokenizer/index.js";const PLUSSIGN=43,HYPHENMINUS=45,N=110,DISALLOW_SIGN=!0,ALLOW_SIGN=!1;function isDelim(e,t){return null!==e&&e.type===Delim&&e.value.charCodeAt(0)===t}function skipSC(e,t,r){for(;null!==e&&(e.type===WhiteSpace||e.type===Comment);)e=r(++t);return t}function checkInteger(e,t,r,n){if(!e)return 0;const u=e.value.charCodeAt(t);if(43===u||45===u){if(r)return 0;t++}for(;t<e.value.length;t++)if(!isDigit(e.value.charCodeAt(t)))return 0;return n+1}function consumeB(e,t,r){let n=!1,u=skipSC(e,t,r);if(null===(e=r(u)))return t;if(e.type!==NumberToken){if(!isDelim(e,43)&&!isDelim(e,45))return t;if(n=!0,u=skipSC(r(++u),u,r),null===(e=r(u))||e.type!==NumberToken)return 0}if(!n){const t=e.value.charCodeAt(0);if(43!==t&&45!==t)return 0}return checkInteger(e,n?0:1,n,u)}export default function anPlusB(e,t){let r=0;if(!e)return 0;if(e.type===NumberToken)return checkInteger(e,0,false,r);if(e.type===Ident&&45===e.value.charCodeAt(0)){if(!cmpChar(e.value,1,N))return 0;switch(e.value.length){case 2:return consumeB(t(++r),r,t);case 3:return 45!==e.value.charCodeAt(2)?0:(r=skipSC(t(++r),r,t),checkInteger(e=t(r),0,true,r));default:return 45!==e.value.charCodeAt(2)?0:checkInteger(e,3,true,r)}}else if(e.type===Ident||isDelim(e,43)&&t(r+1).type===Ident){if(e.type!==Ident&&(e=t(++r)),null===e||!cmpChar(e.value,0,N))return 0;switch(e.value.length){case 1:return consumeB(t(++r),r,t);case 2:return 45!==e.value.charCodeAt(1)?0:(r=skipSC(t(++r),r,t),checkInteger(e=t(r),0,true,r));default:return 45!==e.value.charCodeAt(1)?0:checkInteger(e,2,true,r)}}else if(e.type===Dimension){let n=e.value.charCodeAt(0),u=43===n||45===n?1:0,i=u;for(;i<e.value.length&&isDigit(e.value.charCodeAt(i));i++);return i===u?0:cmpChar(e.value,i,N)?i+1===e.value.length?consumeB(t(++r),r,t):45!==e.value.charCodeAt(i+1)?0:i+2===e.value.length?(r=skipSC(t(++r),r,t),checkInteger(e=t(r),0,true,r)):checkInteger(e,i+2,true,r):0}return 0}