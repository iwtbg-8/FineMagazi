import{cssWideKeywords}from"./generic-const.js";import anPlusB from"./generic-an-plus-b.js";import urange from"./generic-urange.js";import{isIdentifierStart,isHexDigit,isDigit,cmpStr,consumeNumber,Ident,Function as FunctionToken,AtKeyword,Hash,String as StringToken,BadString,Url,BadUrl,Delim,Number as NumberToken,Percentage,Dimension,WhiteSpace,CDO,CDC,Colon,Semicolon,Comma,LeftSquareBracket,RightSquareBracket,LeftParenthesis,RightParenthesis,LeftCurlyBracket,RightCurlyBracket}from"../tokenizer/index.js";const calcFunctionNames=["calc(","-moz-calc(","-webkit-calc("],balancePair=new Map([[FunctionToken,RightParenthesis],[LeftParenthesis,RightParenthesis],[LeftSquareBracket,RightSquareBracket],[LeftCurlyBracket,RightCurlyBracket]]),LENGTH=["cm","mm","q","in","pt","pc","px","em","rem","ex","rex","cap","rcap","ch","rch","ic","ric","lh","rlh","vw","svw","lvw","dvw","vh","svh","lvh","dvh","vi","svi","lvi","dvi","vb","svb","lvb","dvb","vmin","svmin","lvmin","dvmin","vmax","svmax","lvmax","dvmax","cqw","cqh","cqi","cqb","cqmin","cqmax"],ANGLE=["deg","grad","rad","turn"],TIME=["s","ms"],FREQUENCY=["hz","khz"],RESOLUTION=["dpi","dpcm","dppx","x"],FLEX=["fr"],DECIBEL=["db"],SEMITONES=["st"];function charCodeAt(e,t){return t<e.length?e.charCodeAt(t):0}function eqStr(e,t){return cmpStr(e,0,e.length,t)}function eqStrAny(e,t){for(let n=0;n<t.length;n++)if(eqStr(e,t[n]))return!0;return!1}function isPostfixIeHack(e,t){return t===e.length-2&&(92===charCodeAt(e,t)&&isDigit(charCodeAt(e,t+1)))}function outOfRange(e,t,n){if(e&&"Range"===e.type){const r=Number(void 0!==n&&n!==t.length?t.substr(0,n):t);if(isNaN(r))return!0;if(null!==e.min&&r<e.min&&"string"!=typeof e.min)return!0;if(null!==e.max&&r>e.max&&"string"!=typeof e.max)return!0}return!1}function consumeFunction(e,t){let n=0,r=[],a=0;e:do{switch(e.type){case RightCurlyBracket:case RightParenthesis:case RightSquareBracket:if(e.type!==n)break e;if(n=r.pop(),0===r.length){a++;break e}break;case FunctionToken:case LeftParenthesis:case LeftSquareBracket:case LeftCurlyBracket:r.push(n),n=balancePair.get(e.type)}a++}while(e=t(a));return a}function calc(e){return function(t,n,r){return null===t?0:t.type===FunctionToken&&eqStrAny(t.value,calcFunctionNames)?consumeFunction(t,n):e(t,n,r)}}function tokenType(e){return function(t){return null===t||t.type!==e?0:1}}function customIdent(e){if(null===e||e.type!==Ident)return 0;const t=e.value.toLowerCase();return eqStrAny(t,cssWideKeywords)||eqStr(t,"default")?0:1}function customPropertyName(e){return null===e||e.type!==Ident||45!==charCodeAt(e.value,0)||45!==charCodeAt(e.value,1)?0:1}function hexColor(e){if(null===e||e.type!==Hash)return 0;const t=e.value.length;if(4!==t&&5!==t&&7!==t&&9!==t)return 0;for(let n=1;n<t;n++)if(!isHexDigit(charCodeAt(e.value,n)))return 0;return 1}function idSelector(e){return null===e||e.type!==Hash?0:isIdentifierStart(charCodeAt(e.value,1),charCodeAt(e.value,2),charCodeAt(e.value,3))?1:0}function declarationValue(e,t){if(!e)return 0;let n=0,r=[],a=0;e:do{switch(e.type){case BadString:case BadUrl:break e;case RightCurlyBracket:case RightParenthesis:case RightSquareBracket:if(e.type!==n)break e;n=r.pop();break;case Semicolon:if(0===n)break e;break;case Delim:if(0===n&&"!"===e.value)break e;break;case FunctionToken:case LeftParenthesis:case LeftSquareBracket:case LeftCurlyBracket:r.push(n),n=balancePair.get(e.type)}a++}while(e=t(a));return a}function anyValue(e,t){if(!e)return 0;let n=0,r=[],a=0;e:do{switch(e.type){case BadString:case BadUrl:break e;case RightCurlyBracket:case RightParenthesis:case RightSquareBracket:if(e.type!==n)break e;n=r.pop();break;case FunctionToken:case LeftParenthesis:case LeftSquareBracket:case LeftCurlyBracket:r.push(n),n=balancePair.get(e.type)}a++}while(e=t(a));return a}function dimension(e){return e&&(e=new Set(e)),function(t,n,r){if(null===t||t.type!==Dimension)return 0;const a=consumeNumber(t.value,0);if(null!==e){const n=t.value.indexOf("\\",a),r=-1!==n&&isPostfixIeHack(t.value,n)?t.value.substring(a,n):t.value.substr(a);if(!1===e.has(r.toLowerCase()))return 0}return outOfRange(r,t.value,a)?0:1}}function percentage(e,t,n){return null===e||e.type!==Percentage||outOfRange(n,e.value,e.value.length-1)?0:1}function zero(e){return"function"!=typeof e&&(e=function(){return 0}),function(t,n,r){return null!==t&&t.type===NumberToken&&0===Number(t.value)?1:e(t,n,r)}}function number(e,t,n){if(null===e)return 0;const r=consumeNumber(e.value,0);return r===e.value.length||isPostfixIeHack(e.value,r)?outOfRange(n,e.value,r)?0:1:0}function integer(e,t,n){if(null===e||e.type!==NumberToken)return 0;let r=43===charCodeAt(e.value,0)||45===charCodeAt(e.value,0)?1:0;for(;r<e.value.length;r++)if(!isDigit(charCodeAt(e.value,r)))return 0;return outOfRange(n,e.value,r)?0:1}export default{"ident-token":tokenType(Ident),"function-token":tokenType(FunctionToken),"at-keyword-token":tokenType(AtKeyword),"hash-token":tokenType(Hash),"string-token":tokenType(StringToken),"bad-string-token":tokenType(BadString),"url-token":tokenType(Url),"bad-url-token":tokenType(BadUrl),"delim-token":tokenType(Delim),"number-token":tokenType(NumberToken),"percentage-token":tokenType(Percentage),"dimension-token":tokenType(Dimension),"whitespace-token":tokenType(WhiteSpace),"CDO-token":tokenType(CDO),"CDC-token":tokenType(CDC),"colon-token":tokenType(Colon),"semicolon-token":tokenType(Semicolon),"comma-token":tokenType(Comma),"[-token":tokenType(LeftSquareBracket),"]-token":tokenType(RightSquareBracket),"(-token":tokenType(LeftParenthesis),")-token":tokenType(RightParenthesis),"{-token":tokenType(LeftCurlyBracket),"}-token":tokenType(RightCurlyBracket),string:tokenType(StringToken),ident:tokenType(Ident),"custom-ident":customIdent,"custom-property-name":customPropertyName,"hex-color":hexColor,"id-selector":idSelector,"an-plus-b":anPlusB,urange:urange,"declaration-value":declarationValue,"any-value":anyValue,dimension:calc(dimension(null)),angle:calc(dimension(ANGLE)),decibel:calc(dimension(DECIBEL)),frequency:calc(dimension(FREQUENCY)),flex:calc(dimension(FLEX)),length:calc(zero(dimension(LENGTH))),resolution:calc(dimension(RESOLUTION)),semitones:calc(dimension(SEMITONES)),time:calc(dimension(TIME)),percentage:calc(percentage),zero:zero(),number:calc(number),integer:calc(integer)};